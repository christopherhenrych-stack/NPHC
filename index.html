<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Value Governance Dashboard</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --color-slate-50: #f8fafc;
            --color-slate-100: #f1f5f9;
            --color-slate-200: #e2e8f0;
            --color-slate-300: #cbd5e1;
            --color-slate-400: #94a3b8;
            --color-slate-500: #64748b;
            --color-slate-600: #475569;
            --color-slate-700: #334155;
            --color-slate-800: #1e293b;
            --color-slate-900: #0f172a;
            --color-red-50: #fef2f2;
            --color-red-100: #fee2e2;
            --color-red-600: #dc2626;
            --color-red-700: #b91c1c;
            --color-red-800: #991b1b;
            --color-green-100: #dcfce7;
            --color-green-600: #16a34a;
            --color-green-700: #15803d;
            --color-orange-100: #ffedd5;
            --color-orange-600: #ea580c;
            --color-orange-700: #c2410c;
            --color-blue-100: #dbeafe;
            --color-blue-600: #2563eb;
            --color-purple-100: #ede9fe;
            --color-purple-600: #7c3aed;
            --color-yellow-100: #fef3c7;
            --color-yellow-700: #b45309;
            --font-sans: ui-sans-serif, system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            --font-display: ui-sans-serif, system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            --shadow-soft: 0 8px 20px rgba(15, 23, 42, 0.08);
            --shadow-elevated: 0 18px 45px rgba(15, 23, 42, 0.14);
            --glass: rgba(255, 255, 255, 0.7);
        }

        body {
            font-family: var(--font-sans);
            background: radial-gradient(circle at top right, rgba(185, 28, 28, 0.08), transparent 35%),
                        radial-gradient(circle at 20% 20%, rgba(37, 99, 235, 0.06), transparent 35%),
                        var(--color-slate-100);
            color: var(--color-slate-900);
            line-height: 1.5;
            overflow: hidden;
        }

        /* Alert Banner */
        .alert-banner {
            background-color: var(--color-red-700);
            color: white;
            padding: 0.5rem 0;
            overflow: hidden;
            white-space: nowrap;
            position: relative;
            z-index: 60;
            font-weight: 600;
            font-size: 0.875rem;
            display: none; /* Hidden by default, shown if alerts exist */
        }

        .alert-content {
            display: inline-block;
            padding-left: 100%;
            animation: scroll-left 30s linear infinite;
        }

        @keyframes scroll-left {
            0% { transform: translateX(0); }
            100% { transform: translateX(-100%); }
        }

        @keyframes rise-in {
            0% { opacity: 0; transform: translateY(8px); }
            100% { opacity: 1; transform: translateY(0); }
        }

        /* Top Navigation */
        .top-nav {
            background: linear-gradient(135deg, #0f172a 0%, #111827 55%, #1f2937 100%);
            color: white;
            padding: 1rem;
            display: flex;
            align-items: center;
            justify-content: space-between;
            box-shadow: var(--shadow-soft);
            position: relative;
            z-index: 50;
        }

        .top-nav-left {
            display: flex;
            align-items: center;
            gap: 1.5rem;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .logo-icon {
            background-color: var(--color-red-700);
            color: white;
            width: 40px;
            height: 40px;
            border-radius: 0.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            font-weight: 700;
        }

        .logo-title {
            font-size: 1.25rem;
            font-weight: 700;
            letter-spacing: -0.025em;
        }

        .logo-highlight {
            color: var(--color-red-600);
        }

        .logo-subtitle {
            font-size: 0.625rem;
            color: var(--color-slate-400);
            letter-spacing: 0.1em;
            text-transform: uppercase;
        }

        .mobile-menu-btn {
            display: none;
            background: none;
            border: none;
            color: white;
            cursor: pointer;
            padding: 0.5rem;
        }

        .page-tabs {
            display: flex;
            gap: 0.25rem;
        }

        .page-tab {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 1rem;
            background: none;
            border: none;
            color: rgba(255,255,255,0.7);
            cursor: pointer;
            border-radius: 0.5rem;
            font-size: 0.875rem;
            font-weight: 600;
            transition: all 0.2s;
        }

        .page-tab:hover {
            background-color: rgba(255,255,255,0.1);
            color: white;
        }

        .page-tab.active {
            background: linear-gradient(120deg, var(--color-red-700), var(--color-red-600));
            color: white;
        }

        .user-actions {
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .header-search {
            position: relative;
        }

        .header-search input {
            width: 260px;
            padding: 0.5rem 0.75rem;
            border: 1px solid rgba(255, 255, 255, 0.25);
            border-radius: 0.5rem;
            background: rgba(255, 255, 255, 0.08);
            color: white;
            font-size: 0.8rem;
        }

        .header-search input::placeholder {
            color: rgba(255, 255, 255, 0.6);
        }

        .header-search-results {
            position: absolute;
            right: 0;
            top: calc(100% + 0.5rem);
            width: 360px;
            max-height: 280px;
            overflow-y: auto;
            background: white;
            border: 1px solid var(--color-slate-200);
            border-radius: 0.75rem;
            box-shadow: 0 12px 24px rgba(0,0,0,0.15);
            z-index: 2000;
            padding: 0.5rem;
            display: none;
        }

        .icon-btn {
            background: none;
            border: none;
            color: white;
            cursor: pointer;
            padding: 0.5rem;
            border-radius: 0.375rem;
            transition: background-color 0.2s;
        }

        .icon-btn:hover {
            background-color: rgba(255,255,255,0.1);
        }

        .user-badge {
            background-color: var(--color-red-700);
            color: white;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 0.875rem;
        }

        /* Layout */
        .app-container {
            display: flex;
            height: calc(100vh - 72px);
            position: relative;
        }

        /* Sidebar */
        .sidebar {
            width: 280px;
            background: var(--glass);
            border-right: 1px solid rgba(226, 232, 240, 0.8);
            display: flex;
            flex-direction: column;
            overflow-y: auto;
            transition: transform 0.3s ease;
            backdrop-filter: blur(14px);
        }

        .sidebar-hidden {
            transform: translateX(-100%);
            position: absolute;
            height: 100%;
            z-index: 40;
        }

        .sidebar-section {
            padding: 1.5rem 1rem;
            border-bottom: 1px solid var(--color-slate-200);
        }

        .sidebar-calendar {
            background-color: var(--color-slate-50);
        }

        .calendar-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 1rem;
        }

        .calendar-header h3 {
            font-size: 0.875rem;
            font-weight: 700;
            color: var(--color-slate-700);
        }

        .calendar-nav {
            display: flex;
            gap: 0.25rem;
        }

        .calendar-nav-btn {
            background: none;
            border: none;
            padding: 0.25rem;
            cursor: pointer;
            color: var(--color-slate-500);
            border-radius: 0.25rem;
            transition: all 0.2s;
        }

        .calendar-nav-btn:hover {
            background-color: var(--color-slate-200);
            color: var(--color-slate-900);
        }

        .calendar-grid {
    display: grid;
    grid-template-columns: repeat(5, 1fr);
    gap: 1px;
    background: var(--color-slate-200);
    border: 1px solid var(--color-slate-200);
}

        .calendar-day-header {
            font-size: 0.35rem;
            font-weight: 700;
            color: var(--color-slate-400);
            margin-bottom: 0.25rem;
        }

        .calendar-day {
            font-size: 0.625rem;
            height: 1.5rem;
            width: 1.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 9999px;
            color: var(--color-slate-600);
            cursor: pointer;
            transition: background-color 0.2s;
        }
        
        .calendar-day.past {
            color: var(--color-slate-300);
            background-color: var(--color-slate-100);
        }
        
        .schedule-day.past {
            opacity: 0.55;
        }
        
        .schedule-day.past .schedule-header {
            background-color: var(--color-slate-200);
            color: var(--color-slate-400);
        }

        .calendar-day:hover {
            background-color: var(--color-slate-200);
        }

        .calendar-day.today {
            background-color: var(--color-red-700);
            color: white;
            font-weight: 700;
        }

        /* Sidebar Accordion */
        .sidebar-accordion {
            border-bottom: 1px solid var(--color-slate-200);
            background: var(--color-slate-50);
            border-radius: 0.5rem;
            margin: 0 0.75rem 0.75rem;
        }

        .accordion-header {
            width: 100%;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 1rem;
            text-align: left;
            background: var(--color-slate-50);
            border: none;
            cursor: pointer;
            transition: background-color 0.2s;
        }

        .accordion-header:hover {
            background-color: var(--color-slate-100);
        }

        .accordion-title {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.875rem;
            font-weight: 700;
            color: var(--color-slate-700);
        }

        .accordion-icon {
            color: var(--color-slate-400);
        }

        .chevron {
            transition: transform 0.2s;
        }

        .accordion-header.open .chevron {
            transform: rotate(180deg);
        }

        .accordion-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease-out;
        }

        .accordion-content.open {
            max-height: 500px;
            padding: 0 1rem 1rem;
        }

        /* Sidebar Links */
        .sidebar-link {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem;
            border-radius: 0.375rem;
            text-decoration: none;
            color: var(--color-slate-600);
            font-size: 0.75rem;
            transition: all 0.2s;
            margin-bottom: 0.25rem;
        }

        .sidebar-link:hover {
            background-color: var(--color-slate-50);
            color: var(--color-slate-900);
        }

        /* Completed Items */
        .completed-item {
            display: flex;
            align-items: start;
            gap: 0.5rem;
            padding: 0.5rem;
            background-color: var(--color-slate-50);
            border: 1px solid var(--color-slate-100);
            border-radius: 0.375rem;
            margin-bottom: 0.5rem;
        }

        .completed-icon {
            color: var(--color-green-600);
            flex-shrink: 0;
            width: 14px;
            height: 14px;
            margin-top: 2px;
        }

        .completed-item-title {
            font-size: 0.75rem;
            font-weight: 700;
            color: var(--color-slate-800);
            line-height: 1.2;
        }

        .completed-item-date {
            font-size: 0.75rem;
            color: var(--color-slate-500);
            margin-top: 0.25rem;
        }

        .completed-badge {
            font-size: 0.625rem;
            font-weight: 700;
            color: var(--color-green-700);
            background-color: var(--color-green-100);
            padding: 0 0.375rem;
            border-radius: 9999px;
            text-transform: uppercase;
            margin-left: 0.5rem;
        }

        /* Sidebar Footer */
        .sidebar-footer {
            margin-top: auto;
            padding: 1rem;
            border-top: 1px solid var(--color-slate-200);
            background-color: var(--color-slate-50);
        }

        .signout-btn {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            width: 100%;
            padding: 0.5rem;
            background: none;
            border: none;
            color: var(--color-slate-500);
            font-size: 0.75rem;
            font-weight: 700;
            cursor: pointer;
            transition: color 0.2s;
        }

        .signout-btn:hover {
            color: var(--color-red-700);
        }

        /* Main Content */
        .main-content {
            flex: 1;
            overflow: hidden;
            background-color: transparent;
            position: relative;
        }

        .content-scroll {
            position: absolute;
            inset: 0;
            overflow-y: auto;
            padding: 1rem 1.25rem;
            background: linear-gradient(180deg, rgba(248, 250, 252, 0.9) 0%, rgba(248, 250, 252, 0.6) 100%);
        }

        .content-container {
            max-width: 1600px;
            margin: 0 auto;
            min-height: 100%;
        }

        .page-content {
            display: block;
        }

        .page-content.hidden {
            display: none;
        }

        .section-header {
            margin-bottom: 1rem;
        }

        .section-title {
            font-size: 0.875rem;
            font-weight: 600;
            color: var(--color-slate-500);
            letter-spacing: 0.05em;
            text-transform: uppercase;
        }

        .section-title.overview-title {
            font-size: 1.1rem;
            font-weight: 700;
            letter-spacing: 0.08em;
        }

        /* Cards */
        .card {
            background-color: white;
            border: 1px solid var(--color-slate-200);
            border-radius: 0.75rem;
            box-shadow: var(--shadow-soft);
            padding: 1.1rem 1.25rem;
            margin-bottom: 1rem;
            animation: rise-in 0.35s ease both;
        }

        .card-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 0.6rem;
        }

        .card-title {
            font-size: 1.125rem;
            font-weight: 700;
            color: var(--color-slate-900);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .card-title-icon {
            color: var(--color-red-600);
        }

        /* Red Headers for Deliverables Sections */
        .deliverables-section-header {
    background: var(--color-red-700);
    color: white;
    padding: 1.25rem 1.5rem;
    border-radius: 0.5rem 0.5rem 0 0;
    display: flex;
    align-items: center;
    justify-content: space-between;
}

.deliverables-section-header h2 {
    font-size: 1.25rem;
    font-weight: 700;
    margin: 0;
    display: flex;
    align-items: center;
    gap: 0.75rem;
}

        .deliverables-section-header h2 {
            font-size: 1.125rem;
            font-weight: 700;
            color: white;
            display: flex;
            align-items: center;
            gap: 0.75rem;
            margin: 0;
        }

        .deliverables-section-header svg {
            color: white;
        }

        .deliverables-section-header .icon-btn {
            color: white;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 0.375rem;
            padding: 0.5rem;
        }

        .deliverables-section-header .icon-btn:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        .table-wrapper {
            background: white;
            border-radius: 0.75rem;
            border: 1px solid var(--color-slate-200);
            box-shadow: var(--shadow-soft);
            overflow: hidden;
        }

        /* Deliverables Table */
        .deliverables-table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0;
        }

        .deliverables-table thead {
            background-color: var(--color-slate-50);
        }

        .deliverables-table th {
            padding: 0.6rem 0.75rem;
            text-align: left;
            font-size: 0.6rem;
            font-weight: 800;
            color: var(--color-slate-700);
            text-transform: uppercase;
            letter-spacing: 0.1em;
            border-bottom: 1px solid var(--color-slate-200);
            position: sticky;
            top: 0;
            z-index: 2;
        }

        .deliverables-table td {
            padding: 0.6rem 0.75rem;
            font-size: 0.85rem;
            border-bottom: 1px solid var(--color-slate-100);
            line-height: 1.2;
            vertical-align: middle;
        }

        .deliverables-table tbody tr {
            transition: background-color 0.2s;
            cursor: pointer;
        }

        .deliverables-table tbody tr:hover {
            background-color: rgba(248, 250, 252, 0.8);
        }

        .deliverables-table tbody tr:nth-child(even) {
            background-color: #fbfcfe;
        }

        .hot-indicator {
            width: 8px;
            height: 8px;
            background-color: var(--color-red-600);
            border-radius: 50%;
            display: inline-block;
            margin-right: 0.5rem;
        }

        .item-description {
            font-weight: 600;
            color: var(--color-slate-900);
        }

        .item-subtext {
            font-size: 0.75rem;
            color: var(--color-slate-500);
            font-style: italic;
            margin-top: 0.25rem;
        }

        .remaining-badge {
            display: inline-flex;
            align-items: center;
            padding: 0.25rem 0.5rem;
            font-size: 0.75rem;
            font-weight: 600;
            border-radius: 0.375rem;
            box-shadow: inset 0 0 0 1px rgba(15, 23, 42, 0.05);
        }

        .remaining-badge.critical {
            background-color: var(--color-red-100);
            color: var(--color-red-700);
        }

        .remaining-badge.high {
            background-color: var(--color-orange-100);
            color: var(--color-orange-700);
        }

        .remaining-badge.medium, .remaining-badge.low {
            background-color: var(--color-green-100);
            color: var(--color-green-700);
        }

        .action-link {
            color: var(--color-slate-400);
            transition: color 0.2s;
        }

        .action-link:hover {
            color: var(--color-red-600);
        }

        /* Schedule Grid */
        .schedule-wrapper {
            overflow-x: auto;
            margin: -1rem;
            padding: 1rem;
        }

        .schedule-grid {
            display: grid;
            grid-template-columns: 80px repeat(10, minmax(120px, 1fr));
            gap: 1px;
            background-color: var(--color-slate-200);
            border: 1px solid var(--color-slate-200);
            border-radius: 0.5rem;
            overflow: hidden;
            min-width: 1200px;
        }

        .schedule-header {
            background-color: var(--color-slate-50);
            padding: 0.75rem;
            font-size: 0.75rem;
            font-weight: 700;
            color: var(--color-slate-700);
            text-align: center;
        }

        .schedule-time {
            background-color: white;
            padding: 0.5rem;
            font-size: 0.625rem;
            font-weight: 600;
            color: var(--color-slate-600);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .schedule-cell {
            background-color: white;
            padding: 0.125rem;
            min-height: 60px;
        }

        .schedule-item {
            background-color: var(--color-blue-100);
            border-left: 2px solid var(--color-blue-600);
            padding: 0.25rem 0.375rem;
            border-radius: 0.25rem;
            font-size: 0.6rem;
            margin-bottom: 0.125rem;
            cursor: pointer;
            transition: all 0.2s;
            line-height: 1.2;
            box-shadow: 0 6px 14px rgba(15, 23, 42, 0.08);
        }

        .schedule-item:hover {
            box-shadow: 0 10px 20px rgba(15, 23, 42, 0.12);
            transform: translateY(-1px);
        }

        .schedule-item.deep-work {
            background-color: var(--color-blue-100);
            border-left-color: var(--color-blue-600);
        }

        .schedule-item-title {
            font-weight: 700;
            color: var(--color-slate-900);
            margin-bottom: 2px;
        }

        .schedule-item-time {
            font-size: 0.625rem;
            color: var(--color-slate-600);
        }

        .hot-topic-badge {
            display: inline-flex;
            align-items: center;
            gap: 0.25rem;
            padding: 0.1rem 0.35rem;
            border-radius: 999px;
            font-size: 0.6rem;
            font-weight: 700;
            letter-spacing: 0.02em;
            text-transform: uppercase;
            color: white;
        }

        .hot-topic-urgent { background-color: var(--color-red-600); }
        .hot-topic-attend { background-color: var(--color-orange-600); }
        .hot-topic-default { background-color: var(--color-slate-500); }

        .hot-topic-icon {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 18px;
            height: 18px;
            border-radius: 999px;
            font-size: 0.65rem;
            color: white;
        }

        .meetings-legend {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.7rem;
            color: var(--color-slate-600);
            margin-left: auto;
        }

        .legend-item {
            display: inline-flex;
            align-items: center;
            gap: 0.25rem;
        }

        .agenda-badge {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            padding: 0.1rem 0.35rem;
            border-radius: 999px;
            font-size: 0.6rem;
            font-weight: 700;
            color: var(--color-blue-600);
            background: var(--color-blue-100);
            border: 1px solid rgba(37, 99, 235, 0.2);
        }


        /* Utilities */
        .icon {
            width: 1rem;
            height: 1rem;
        }

        .icon-sm {
            width: 0.875rem;
            height: 0.875rem;
        }

        .icon-xs {
            width: 0.75rem;
            height: 0.75rem;
        }

        .toast {
            position: fixed;
            right: 1.5rem;
            bottom: 1.5rem;
            background: var(--color-slate-900);
            color: white;
            padding: 0.75rem 1rem;
            border-radius: 0.5rem;
            font-size: 0.875rem;
            box-shadow: 0 10px 20px rgba(0,0,0,0.2);
            z-index: 2000;
            opacity: 0;
            transform: translateY(10px);
            transition: opacity 0.2s ease, transform 0.2s ease;
        }

        .toast.show {
            opacity: 1;
            transform: translateY(0);
        }

        .mt-2 { margin-top: 0.5rem; }
        .mt-3 { margin-top: 0.75rem; }
        .mt-6 { margin-top: 1.5rem; }
        .hidden { display: none !important; }

        .loading-message, .loading-spinner {
            text-align: center;
            padding: 2rem;
            color: var(--color-slate-500);
        }

        .input-label {
            display: block;
            font-size: 0.75rem;
            font-weight: 700;
            color: var(--color-slate-700);
            margin-bottom: 0.5rem;
        }

        .input-field {
            width: 100%;
            padding: 0.5rem;
            border: 1px solid var(--color-slate-300);
            border-radius: 0.375rem;
            font-size: 0.875rem;
        }

        .btn-primary {
            width: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            padding: 0.5rem 1rem;
            background: linear-gradient(135deg, var(--color-red-700), var(--color-red-600));
            color: white;
            border: none;
            border-radius: 0.5rem;
            font-weight: 700;
            font-size: 0.875rem;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .btn-primary:hover {
            transform: translateY(-1px);
            box-shadow: var(--shadow-soft);
        }

        .btn-secondary {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            padding: 0.5rem 1rem;
            background-color: rgba(255, 255, 255, 0.9);
            color: var(--color-slate-700);
            border: 1px solid var(--color-slate-300);
            border-radius: 0.5rem;
            font-weight: 600;
            font-size: 0.875rem;
            cursor: pointer;
            transition: all 0.2s;
        }

        .btn-secondary:hover {
            transform: translateY(-1px);
            box-shadow: var(--shadow-soft);
            border-color: var(--color-slate-300);
        }

        .btn-icon-delete {
            background: none;
            border: none;
            color: var(--color-red-600);
            cursor: pointer;
            padding: 0.25rem;
            border-radius: 0.25rem;
            transition: all 0.2s;
        }

        .btn-icon-delete:hover {
            background-color: var(--color-red-50);
            color: var(--color-red-700);
        }

        /* Agenda Modal Styles */
        .agenda-modal {
            position: fixed;
            inset: 0;
            z-index: 100;
            display: flex;
            align-items: center;
            justify-content: center;
            animation: fadeIn 0.2s ease-out;
        }

        .agenda-modal-overlay {
            position: absolute;
            inset: 0;
            background-color: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(4px);
        }

        .agenda-modal-content {
            position: relative;
            background-color: white;
            border-radius: 1rem;
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
            max-width: 600px;
            width: 90%;
            max-height: 90vh;
            display: flex;
            flex-direction: column;
            animation: slideUp 0.3s ease-out;
        }

        .agenda-modal-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 1.5rem;
            border-bottom: 1px solid var(--color-slate-200);
        }

        .agenda-modal-header h2 {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--color-slate-900);
            margin: 0;
        }

        .agenda-modal-close {
            background: none;
            border: none;
            color: var(--color-slate-400);
            cursor: pointer;
            padding: 0.5rem;
            border-radius: 0.5rem;
            transition: all 0.2s;
        }

        .agenda-modal-close:hover {
            background-color: var(--color-slate-100);
            color: var(--color-slate-900);
        }

        .agenda-modal-body {
            padding: 1.5rem;
            overflow-y: auto;
            flex: 1;
        }

        .agenda-info {
            background-color: var(--color-slate-50);
            border: 1px solid var(--color-slate-200);
            border-radius: 0.5rem;
            padding: 1rem;
            margin-bottom: 1.5rem;
        }

        .agenda-info-item {
            font-size: 0.875rem;
            color: var(--color-slate-700);
            margin-bottom: 0.5rem;
        }

        .agenda-info-item:last-child {
            margin-bottom: 0;
        }

        .agenda-info-item strong {
            color: var(--color-slate-900);
            font-weight: 600;
        }

        .agenda-section {
            margin-bottom: 1.5rem;
        }

        .agenda-section h3 {
            font-size: 1rem;
            font-weight: 700;
            color: var(--color-slate-900);
            margin-bottom: 1rem;
        }

        .agenda-topic-item {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            margin-bottom: 0.75rem;
        }

        .agenda-topic-number {
            font-weight: 700;
            color: var(--color-slate-500);
            font-size: 0.875rem;
            min-width: 1.5rem;
        }

        .agenda-topic-input {
            flex: 1;
        }

        .input-hint {
            font-size: 0.75rem;
            color: var(--color-slate-500);
            margin-top: 0.5rem;
            font-style: italic;
        }

        .agenda-modal-footer {
            display: flex;
            align-items: center;
            justify-content: flex-end;
            gap: 0.75rem;
            padding: 1.5rem;
            border-top: 1px solid var(--color-slate-200);
            background-color: var(--color-slate-50);
            border-bottom-left-radius: 1rem;
            border-bottom-right-radius: 1rem;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
            }
            to {
                opacity: 1;
            }
        }

        @keyframes slideUp {
            from {
                transform: translateY(20px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        @media (max-width: 768px) {
            .mobile-menu-btn {
                display: block;
            }
            .page-tabs {
                display: none;
            }
            .sidebar {
                position: absolute;
                z-index: 40;
                height: 100%;
            }
            .content-scroll {
                padding: 1rem;
            }
        }
    
        /* PDF Export Modal */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }
        
        .modal.hidden {
            display: none;
        }
        
        .modal-content {
            background: white;
            border-radius: 1rem;
            width: 90%;
            max-width: 600px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
        }
        
        .modal-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 1.5rem;
            border-bottom: 1px solid var(--color-slate-200);
        }
        
        .modal-title {
            font-size: 1.125rem;
            font-weight: 700;
        }
        
        .close-btn {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--color-slate-500);
        }
        
        .close-btn:hover {
            color: var(--color-slate-900);
        }
        
        .modal-body {
            padding: 1.5rem;
        }
        
        .modal-footer {
            display: flex;
            gap: 0.75rem;
            justify-content: flex-end;
            padding: 1rem 1.5rem;
            border-top: 1px solid var(--color-slate-200);
        }
        
        .btn-primary {
            background-color: var(--color-red-600);
            color: white;
            padding: 0.5rem 1rem;
            border: none;
            border-radius: 0.375rem;
            font-size: 0.875rem;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .btn-primary:hover {
            background-color: var(--color-red-700);
        }
        
        .btn-secondary {
            background-color: var(--color-slate-100);
            color: var(--color-slate-700);
            padding: 0.5rem 1rem;
            border: 1px solid var(--color-slate-300);
            border-radius: 0.375rem;
            font-size: 0.875rem;
            font-weight: 600;
            cursor: pointer;
        }
        
        .btn-secondary:hover {
            background-color: var(--color-slate-200);
        }
    
        /* View Toggle Buttons */
        .view-toggle-btns {
            display: flex;
            gap: 0.25rem;
            background-color: var(--color-slate-100);
            padding: 0.25rem;
            border-radius: 0.5rem;
        }

        .view-btn {
            padding: 0.5rem 1rem;
            border: none;
            background: none;
            color: var(--color-slate-600);
            font-size: 0.875rem;
            font-weight: 600;
            cursor: pointer;
            border-radius: 0.375rem;
            transition: all 0.2s;
        }

        .view-btn:hover {
            background-color: var(--color-slate-200);
        }

        .view-btn.active {
            background-color: var(--color-slate-800);
            color: white;
        }

        .meetings-view {
            display: block;
        }

        .meetings-view.hidden {
            display: none;
        }

        /* Documents Page */
        .documents-page {
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
        }

        .docs-hero {
            background: linear-gradient(135deg, #ffffff 0%, #f8fafc 100%);
            border: 1px solid var(--color-slate-200);
            border-radius: 0.75rem;
            padding: 1rem 1.25rem;
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 1.5rem;
            box-shadow: 0 8px 20px rgba(15, 23, 42, 0.06);
        }

        .docs-hero-title {
            font-size: 1.25rem;
            font-weight: 800;
            color: var(--color-slate-900);
            letter-spacing: 0.02em;
        }

        .docs-hero-subtitle {
            font-size: 0.85rem;
            color: var(--color-slate-600);
            margin-top: 0.35rem;
            max-width: 560px;
        }

        .docs-hero-badge {
            font-size: 0.7rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.08em;
            color: var(--color-red-700);
            background: var(--color-red-50);
            border: 1px solid var(--color-red-100);
            padding: 0.4rem 0.6rem;
            border-radius: 999px;
            white-space: nowrap;
        }

        .docs-grid {
            display: grid;
            grid-template-columns: repeat(2, minmax(0, 1fr));
            gap: 1rem;
        }

        .docs-card {
            background: white;
            border: 1px solid var(--color-slate-200);
            border-radius: 0.75rem;
            box-shadow: 0 6px 16px rgba(15, 23, 42, 0.05);
            overflow: hidden;
            display: flex;
            flex-direction: column;
            min-height: 200px;
        }

        .docs-card-header {
            padding: 0.8rem 1rem;
            border-bottom: 1px solid var(--color-slate-200);
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 0.75rem;
            background: var(--color-slate-50);
        }

        .docs-card-title {
            display: flex;
            align-items: center;
            gap: 0.6rem;
            font-size: 0.95rem;
            font-weight: 800;
            color: var(--color-slate-900);
            text-transform: uppercase;
            letter-spacing: 0.06em;
        }

        .docs-card-title svg {
            color: var(--color-red-600);
        }

        .docs-card-body {
            padding: 0.85rem 1rem 1rem;
        }

        .docs-card-body .table-wrapper {
            margin: 0;
        }

        .docs-card-body .deliverables-table th {
            font-size: 0.6rem;
        }

        .docs-card-body .deliverables-table td {
            font-size: 0.8rem;
        }

        @media (max-width: 1100px) {
            .docs-grid {
                grid-template-columns: 1fr;
            }
        }

        /* Calendar Grid for Month View */
        .calendar-month-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 1px;
            background-color: var(--color-slate-200);
            border: 1px solid var(--color-slate-200);
            border-radius: 0.5rem;
            overflow: hidden;
        }

        .calendar-month-header {
            background-color: var(--color-slate-50);
            padding: 0.75rem 0.5rem;
            font-size: 0.75rem;
            font-weight: 700;
            color: var(--color-slate-600);
            text-align: center;
            text-transform: uppercase;
        }

        .calendar-month-day {
            background-color: white;
            min-height: 120px;
            max-height: 150px;
            padding: 0.5rem;
            vertical-align: top;
            overflow: hidden;
        }

        .calendar-month-day.other-month {
            background-color: var(--color-slate-50);
        }

        .calendar-month-day.today {
            background-color: var(--color-red-50);
        }

        .calendar-day-number {
            font-size: 0.875rem;
            font-weight: 600;
            color: var(--color-slate-700);
            margin-bottom: 0.5rem;
        }

        .calendar-day-number.today {
            background-color: var(--color-red-600);
            color: white;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .calendar-meeting-item {
            background-color: var(--color-blue-100);
            border-left: 3px solid var(--color-blue-600);
            padding: 0.25rem 0.5rem;
            margin-bottom: 0.25rem;
            border-radius: 0.25rem;
            font-size: 0.7rem;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            flex-direction: column;
            gap: 0.15rem;
            white-space: normal;
        }

        .calendar-meeting-item:hover {
            background-color: var(--color-blue-200);
        }

        .calendar-meeting-time {
            font-weight: 700;
            font-size: 0.7rem;
            color: var(--color-slate-700);
        }

        .calendar-meeting-title {
            font-weight: 600;
            font-size: 0.75rem;
            color: var(--color-slate-900);
            line-height: 1.2;
            display: -webkit-box;
            -webkit-line-clamp: 3;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .meeting-color-11 {
            background-color: var(--color-red-100);
            border-left: 3px solid var(--color-red-600);
        }

        .meeting-color-6 {
            background-color: var(--color-orange-100);
            border-left: 3px solid var(--color-orange-600);
        }

        .meeting-color-7 {
            background-color: var(--color-purple-100);
            border-left: 3px solid var(--color-purple-600);
        }

        .meeting-color-5 {
            background-color: var(--color-yellow-100);
            border-left: 3px solid var(--color-yellow-700);
        }

        .meeting-color-10 {
            background-color: var(--color-green-100);
            border-left: 3px solid var(--color-green-600);
        }

        .meeting-color-9 {
            background-color: var(--color-blue-100);
            border-left: 3px solid var(--color-blue-600);
        }

        .meeting-color-8 {
            background-color: var(--color-slate-100);
            border-left: 3px solid var(--color-slate-400);
        }

        .meeting-title-card {
            padding: 0.35rem 0.5rem;
            border-radius: 0.375rem;
        }

        .meeting-hot-urgent {
            background-color: var(--color-red-100);
            border-left-color: var(--color-red-600);
        }

        .meeting-hot-attend {
            background-color: var(--color-orange-100);
            border-left-color: var(--color-orange-600);
        }

        .meeting-hot-default {
            background-color: var(--color-slate-100);
            border-left-color: var(--color-slate-500);
        }

        /* 90 Day View */
        .ninety-day-container {
            display: grid;
            grid-template-columns: repeat(3, minmax(0, 1fr));
            gap: 1.5rem;
        }

        .month-card {
            background: white;
            border-radius: 0.75rem;
            border: 1px solid var(--color-slate-200);
            box-shadow: 0 10px 24px rgba(15, 23, 42, 0.08);
            overflow: hidden;
            display: flex;
            flex-direction: column;
            min-height: 260px;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }

        .month-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 16px 30px rgba(15, 23, 42, 0.12);
        }

        .month-ribbon {
            background: linear-gradient(90deg, var(--color-red-700), var(--color-red-600));
            color: white;
            text-align: center;
            padding: 0.75rem 0.5rem;
            font-weight: 800;
            letter-spacing: 0.08em;
            text-transform: uppercase;
            position: relative;
        }

        .month-ribbon::before,
        .month-ribbon::after {
            content: "";
            position: absolute;
            bottom: -10px;
            width: 0;
            height: 0;
            border-style: solid;
        }

        .month-ribbon::before {
            left: 0;
            border-width: 10px 10px 0 0;
            border-color: #991b1b transparent transparent transparent;
        }

        .month-ribbon::after {
            right: 0;
            border-width: 10px 0 0 10px;
            border-color: #991b1b transparent transparent transparent;
        }

        .month-card-body {
            padding: 0.85rem 1rem 1rem;
            overflow-y: auto;
        }

        .month-events {
            list-style: none;
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
            gap: 0.6rem;
        }

        .month-event {
            display: grid;
            grid-template-columns: 36px 10px 1fr;
            gap: 0.5rem;
            align-items: start;
            padding: 0.5rem 0.4rem;
            border-radius: 0.5rem;
            cursor: pointer;
            transition: background-color 0.2s ease, transform 0.2s ease;
        }

        .month-event-compact {
            display: grid;
            grid-template-columns: 28px 10px 1fr;
            gap: 0.5rem;
            align-items: start;
            padding: 0.4rem 0.35rem;
            border-radius: 0.5rem;
            cursor: pointer;
            transition: background-color 0.2s ease, transform 0.2s ease;
        }

        .month-event-compact.expanded {
            background-color: var(--color-slate-50);
        }

        .month-event-details {
            grid-column: 3;
            margin-top: 0.25rem;
            font-size: 0.7rem;
            color: var(--color-slate-500);
            display: none;
        }

        .month-event-compact.expanded .month-event-details {
            display: block;
        }

        .month-event:hover {
            background-color: var(--color-slate-50);
            transform: translateX(2px);
        }

        .month-event-date {
            font-weight: 800;
            font-size: 0.95rem;
            color: var(--color-slate-700);
            text-align: right;
        }

        .month-event-pipe {
            color: var(--color-slate-300);
            text-align: center;
            font-weight: 700;
        }

        .month-event-title {
            font-size: 0.9rem;
            font-weight: 600;
            color: var(--color-slate-900);
            line-height: 1.35;
        }

        .month-event-meta {
            font-size: 0.75rem;
            color: var(--color-slate-500);
            margin-top: 0.2rem;
        }

        .month-event.hot {
            background-color: var(--color-red-50);
        }

        .month-event.meeting-hot-urgent {
            background-color: var(--color-red-50);
        }

        .month-event.meeting-hot-attend {
            background-color: var(--color-orange-100);
        }

        .month-event.meeting-hot-default {
            background-color: var(--color-slate-100);
        }

        .month-event.hot .month-event-title {
            color: var(--color-red-700);
            font-weight: 700;
        }

        .month-event.prep .month-event-title {
            color: var(--color-blue-600);
        }

        .month-empty {
            color: var(--color-slate-400);
            font-size: 0.85rem;
            text-align: center;
            padding: 1.5rem 0;
            font-style: italic;
        }

        /* Side by Side Deliverables */
        .deliverables-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1.5rem;
        }

        @media (max-width: 1200px) {
            .deliverables-grid {
                grid-template-columns: 1fr;
            }
            .ninety-day-container {
                grid-template-columns: 1fr;
            }
        }

        /* Modal Fixes */
        .meeting-modal {
            position: fixed;
            inset: 0;
            z-index: 1000;
            display: flex;
            align-items: center;
            justify-content: center;
            animation: fadeIn 0.2s ease-out;
        }

        .meeting-modal-overlay {
            position: fixed;
            inset: 0;
            background-color: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(4px);
        }

        .meeting-modal-content {
            position: relative;
            z-index: 1001;
            background-color: white;
            border-radius: 1rem;
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
            max-width: 600px;
            width: 90%;
            max-height: 90vh;
            display: flex;
            flex-direction: column;
            animation: slideUp 0.3s ease-out;
        }

        .meeting-modal-header {
            display: flex;
            align-items: flex-start;
            justify-content: space-between;
            padding: 1.5rem;
            border-bottom: 1px solid var(--color-slate-200);
        }

        .meeting-modal-title {
            font-size: 1.25rem;
            font-weight: 700;
            color: var(--color-slate-900);
        }

        .meeting-modal-subtitle {
            font-size: 0.875rem;
            color: var(--color-slate-500);
            margin-top: 0.25rem;
        }

        .meeting-modal-close {
            background: none;
            border: none;
            color: var(--color-slate-400);
            cursor: pointer;
            padding: 0.5rem;
            border-radius: 0.5rem;
            transition: all 0.2s;
        }

        .meeting-modal-close:hover {
            background-color: var(--color-slate-100);
            color: var(--color-slate-900);
        }

        .meeting-modal-body {
            padding: 1.5rem;
            overflow-y: auto;
            flex: 1;
        }

        .meeting-modal-footer {
            display: flex;
            align-items: center;
            justify-content: flex-end;
            gap: 0.75rem;
            padding: 1.5rem;
            border-top: 1px solid var(--color-slate-200);
            background-color: var(--color-slate-50);
            border-radius: 0 0 1rem 1rem;
        }

        .form-group {
            margin-bottom: 1.25rem;
        }

        .form-label {
            display: block;
            font-size: 0.75rem;
            font-weight: 700;
            color: var(--color-slate-700);
            margin-bottom: 0.5rem;
        }

        .form-select, .form-input {
            width: 100%;
            padding: 0.625rem;
            border: 1px solid var(--color-slate-300);
            border-radius: 0.375rem;
            font-size: 0.875rem;
            background-color: white;
        }

        .form-select:focus, .form-input:focus {
            outline: none;
            border-color: var(--color-red-600);
            box-shadow: 0 0 0 3px rgba(220, 38, 38, 0.1);
        }

        .form-textarea {
            width: 100%;
            padding: 0.625rem;
            border: 1px solid var(--color-slate-300);
            border-radius: 0.375rem;
            font-size: 0.875rem;
            min-height: 100px;
            resize: vertical;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
        }

        .linked-docs-section {
            background-color: var(--color-slate-50);
            border: 1px solid var(--color-slate-200);
            border-radius: 0.5rem;
            padding: 1rem;
            margin-top: 1rem;
        }

        .linked-docs-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 0.75rem;
        }

        .linked-docs-title {
            font-size: 0.875rem;
            font-weight: 700;
            color: var(--color-slate-700);
        }

        .add-link-btn {
            font-size: 0.75rem;
            color: var(--color-red-600);
            background: none;
            border: none;
            cursor: pointer;
            font-weight: 600;
        }

        .add-link-btn:hover {
            text-decoration: underline;
        }

    

.modal-overlay {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0, 0, 0, 0.5);
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 10000;
    padding: 1rem;
    animation: fadeIn 0.2s ease-out;
}

@keyframes fadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
}

.modal-container {
    background: white;
    border-radius: 0.5rem;
    box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
    max-height: 90vh;
    display: flex;
    flex-direction: column;
    animation: slideUp 0.3s ease-out;
}

@keyframes slideUp {
    from { transform: translateY(20px); opacity: 0; }
    to { transform: translateY(0); opacity: 1; }
}

.modal-header {
    padding: 1.5rem;
    border-bottom: 1px solid var(--color-slate-200);
    display: flex;
    align-items: center;
    justify-content: space-between;
}

.modal-title {
    font-size: 1.25rem;
    font-weight: 700;
    color: var(--color-slate-900);
}

.modal-close-btn {
    background: none;
    border: none;
    color: var(--color-slate-400);
    cursor: pointer;
    padding: 0.25rem;
    border-radius: 0.25rem;
    transition: all 0.2s;
}

.modal-close-btn:hover {
    background: var(--color-slate-100);
    color: var(--color-slate-600);
}

.modal-body {
    padding: 1.5rem;
    overflow-y: auto;
    flex: 1;
}

.modal-footer {
    padding: 1rem 1.5rem;
    border-top: 1px solid var(--color-slate-200);
    display: flex;
    gap: 0.75rem;
    justify-content: flex-end;
}

.form-group {
    margin-bottom: 1.25rem;
}

.form-row {
    display: flex;
    gap: 1rem;
    margin-bottom: 1.25rem;
}

.form-label {
    display: block;
    font-size: 0.875rem;
    font-weight: 600;
    color: var(--color-slate-700);
    margin-bottom: 0.5rem;
}

.form-input,
.form-textarea {
    width: 100%;
    padding: 0.625rem 0.75rem;
    border: 1px solid var(--color-slate-300);
    border-radius: 0.375rem;
    font-size: 0.875rem;
    color: var(--color-slate-900);
    transition: all 0.2s;
}

.form-input:focus,
.form-textarea:focus {
    outline: none;
    border-color: var(--color-red-600);
    box-shadow: 0 0 0 3px rgba(220, 38, 38, 0.1);
}

.form-textarea {
    resize: vertical;
    min-height: 80px;
}

.form-hint {
    margin-top: 0.375rem;
    font-size: 0.75rem;
    color: var(--color-slate-500);
}

.linked-docs-list {
    border: 1px solid var(--color-slate-200);
    border-radius: 0.375rem;
    padding: 0.75rem;
    margin-bottom: 0.5rem;
    min-height: 60px;
}

.linked-doc-item {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 0.5rem;
    background: var(--color-slate-50);
    border-radius: 0.25rem;
    margin-bottom: 0.5rem;
}

.linked-doc-item:last-child {
    margin-bottom: 0;
}

.linked-doc-item a {
    color: var(--color-blue-600);
    text-decoration: none;
    font-size: 0.875rem;
    flex: 1;
}

.linked-doc-item a:hover {
    text-decoration: underline;
}

.remove-doc-btn {
    background: none;
    border: none;
    color: var(--color-red-600);
    font-size: 1.25rem;
    cursor: pointer;
    padding: 0 0.5rem;
    line-height: 1;
}

.remove-doc-btn:hover {
    color: var(--color-red-700);
}

.no-docs-msg {
    color: var(--color-slate-400);
    font-size: 0.875rem;
    font-style: italic;
    text-align: center;
    padding: 1rem;
}

.btn-link {
    background: none;
    border: none;
    color: var(--color-red-600);
    font-size: 0.875rem;
    font-weight: 600;
    cursor: pointer;
    padding: 0.5rem 0;
}

.btn-link:hover {
    color: var(--color-red-700);
    text-decoration: underline;
}

.btn-danger {
    background: white;
    border: 1px solid var(--color-red-600);
    color: var(--color-red-600);
    padding: 0.625rem 1.25rem;
    border-radius: 0.375rem;
    font-size: 0.875rem;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.2s;
}

.btn-danger:hover {
    background: var(--color-red-50);
}

.btn-danger:disabled {
    opacity: 0.5;
    cursor: not-allowed;
}

    </style>
    <!-- PDF Export Libraries -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
</head>
<body>
    <div id="alertBanner" class="alert-banner">
        <div id="alertContent" class="alert-content"></div>
    </div>
    <nav class="top-nav">
        <div class="top-nav-left">
            <button class="mobile-menu-btn" onclick="toggleSidebar()">
                <svg class="icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"/>
                </svg>
            </button>
            <div class="logo">
                <div class="logo-icon">V</div>
                <div class="logo-text">
                    <div class="logo-title">Value Governance <span class="logo-highlight">Dashboard</span></div>
                    <div class="logo-subtitle">Strategic Command Center</div>
                </div>
            </div>
            <div class="page-tabs">
                <button class="page-tab active" onclick="switchPage('overview')">
                    <svg class="icon-sm" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"/>
                    </svg>
                    Overview
                </button>
                <button class="page-tab" onclick="switchPage('meetings')">
                    <svg class="icon-sm" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/>
                    </svg>
                    Meetings
                </button>
                <button class="page-tab" onclick="switchPage('documents')">
                    <svg class="icon-sm" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-6l-2-2H5a2 2 0 00-2 2z"/>
                    </svg>
                    Documents
                </button>
            </div>
        </div>
        <div class="user-actions">
            <button class="icon-btn" title="Refresh / Sync" onclick="refreshDashboard()">
                <svg class="icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v6h6M20 20v-6h-6M5 15a7 7 0 0012.906 1.5M19 9A7 7 0 006.094 7.5"/>
                </svg>
            </button>
            <div class="header-search">
                <input type="text" id="meetingSearchInput" placeholder="Search meetings..." />
                <div id="meetingSearchResults" class="header-search-results"></div>
            </div>
            <button class="icon-btn" title="Notifications">
                <svg class="icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9"/>
                </svg>
            </button>
            <button class="icon-btn" title="Settings">
                <svg class="icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"/>
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/>
                </svg>
            </button>
            <div class="user-badge">E2</div>
        </div>
    </nav>

    <!-- App Container -->
    <div class="app-container">
        <!-- Sidebar -->
        <aside class="sidebar" id="sidebar">
            <!-- Calendar Widget -->
            <div class="sidebar-section sidebar-calendar">
                <div class="calendar-header">
                    <h3 id="calendarMonth">January 2026</h3>
                    <div class="calendar-nav">
                        <button class="calendar-nav-btn" onclick="previousMonth()">
                            <svg class="icon-xs" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/>
                            </svg>
                        </button>
                        <button class="calendar-nav-btn" onclick="nextMonth()">
                            <svg class="icon-xs" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
                            </svg>
                        </button>
                    </div>
                </div>
                <div class="calendar-grid" style="grid-template-columns: repeat(5, 1fr);">
                    <div class="calendar-day-header">MON</div>
                    <div class="calendar-day-header">TUE</div>
                    <div class="calendar-day-header">WED</div>
                    <div class="calendar-day-header">THU</div>
                    <div class="calendar-day-header">FRI</div>
                </div>
                <div class="calendar-grid" id="calendarDays"></div>
            </div>

            <!-- Admin & Settings -->
            <div class="sidebar-accordion">
                <button class="accordion-header" onclick="toggleAccordion(this)">
                    <span class="accordion-title">
                        <svg class="icon-xs accordion-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6V4m0 2a2 2 0 100 4m0-4a2 2 0 110 4m-6 8a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4m6 6v10m6-2a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4"/>
                        </svg>
                        Admin & Settings
                    </span>
                    <svg class="icon-xs accordion-icon chevron" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>
                    </svg>
                </button>
                <div class="accordion-content" id="adminLinks">
                    <div class="loading-spinner">Loading...</div>
                </div>
            </div>

            <!-- KPIs & Performance -->
            <div class="sidebar-accordion">
                <button class="accordion-header" onclick="toggleAccordion(this)">
                    <span class="accordion-title">
                        <svg class="icon-xs accordion-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"/>
                        </svg>
                        KPIs & Performance
                    </span>
                    <svg class="icon-xs accordion-icon chevron" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>
                    </svg>
                </button>
                <div class="accordion-content" id="kpiLinks">
                    <div class="loading-spinner">Loading...</div>
                </div>
            </div>

            <!-- Executive Updates -->
            <div class="sidebar-accordion">
                <button class="accordion-header" onclick="toggleAccordion(this)">
                    <span class="accordion-title">
                        <svg class="icon-xs accordion-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
                        </svg>
                        Executive Updates
                    </span>
                    <svg class="icon-xs accordion-icon chevron" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>
                    </svg>
                </button>
                <div class="accordion-content" id="executiveUpdates">
                    <div class="loading-spinner">Loading...</div>
                </div>
            </div>

            <!-- Document Repository -->
            <div class="sidebar-accordion">
                <button class="accordion-header" onclick="toggleAccordion(this)">
                    <span class="accordion-title">
                        <svg class="icon-xs accordion-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-6l-2-2H5a2 2 0 00-2 2z"/>
                        </svg>
                        Document Repository
                    </span>
                    <svg class="icon-xs accordion-icon chevron" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>
                    </svg>
                </button>
                <div class="accordion-content" id="documentRepoLinks">
                    <div class="loading-spinner">Loading...</div>
                </div>
            </div>

            <!-- Exec 2's Completed Items -->
            <div class="sidebar-accordion">
                <button class="accordion-header" onclick="toggleAccordion(this)">
                    <span class="accordion-title">
                        <svg class="icon-xs accordion-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"/>
                        </svg>
                        DK's Completed Items
                    </span>
                    <svg class="icon-xs accordion-icon chevron" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>
                    </svg>
                </button>
                <div class="accordion-content" id="completedItems">
                    <div class="loading-spinner">Loading...</div>
                </div>
            </div>

            <!-- Upcoming Agendas -->
            <div class="sidebar-accordion">
                <button class="accordion-header" onclick="toggleAccordion(this)">
                    <span class="accordion-title">
                        <svg class="icon-xs accordion-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"/>
                        </svg>
                        Upcoming Agendas
                    </span>
                    <svg class="icon-xs accordion-icon chevron" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>
                    </svg>
                </button>
                <div class="accordion-content">
                    <div class="agenda-builder">
                        <label class="input-label">Select Recurring Meeting</label>
                        <select class="input-field" id="recurringMeetingSelect">
                            <option value="">-- Select Meeting --</option>
                        </select>
                        <div class="mt-3 hidden" id="agendaDateSection">
                            <label class="input-label">Select Date</label>
                            <input type="date" class="input-field" id="agendaDate">
                            <button class="btn-primary mt-2" onclick="handleCreateAgenda()">
                                <svg class="icon-xs" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/>
                                </svg>
                                Create Agenda
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Sidebar Footer -->
            <div class="sidebar-footer">
                <button class="signout-btn">
                    <svg class="icon-xs" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"/>
                    </svg>
                    <span>Sign Out</span>
                </button>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <div class="content-scroll">
                <div class="content-container" id="mainContent">
                    <!-- Overview Page -->
                    <div id="overviewPage" class="page-content">
                        <div class="section-header">
                            <h2 class="section-title overview-title">DASHBOARD CONTEXT</h2>
                        </div>
                        
                        <!-- Deliverables Section -->
                        <div id="deliverablesSection">
                            <div class="loading-message">Loading dashboard data...</div>
                        </div>

                        <!-- 2-Week Schedule -->
                        <div id="scheduleSection" class="mt-6">
                            <div class="loading-message">Loading schedule...</div>
                        </div>
                    </div>

                    <!-- Meetings Page -->
                    <div id="meetingsPage" class="page-content hidden">
                        <div class="card">
                            <div class="card-header">
                                <h2 class="card-title">
                                    <svg class="icon card-title-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/>
                                    </svg>
                                    Meetings & Scheduling
                                </h2>
                                <span style="font-size: 0.75rem; color: var(--color-slate-500);">Executive View</span>
                                <div class="meetings-legend">
                                    <span class="legend-item"><span class="hot-topic-icon hot-topic-urgent"></span>Urgent</span>
                                    <span class="legend-item"><span class="hot-topic-icon hot-topic-attend"></span>Must Attend</span>
                                    <span class="legend-item"><span class="hot-topic-icon hot-topic-default"></span>Hot Topic</span>
                                </div>
                            </div>
                            <!-- View Toggle Buttons -->
                            <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 1rem;">
                                <div class="view-toggle-btns" style="display: flex; gap: 0.25rem;">
                                    <button class="view-btn active" data-view="month" onclick="switchMeetingsView('month')">Month</button>
                                    <button class="view-btn" data-view="list" onclick="switchMeetingsView('list')">List</button>
                                    <button class="view-btn" data-view="90day" onclick="switchMeetingsView('90day')">90 Day</button>
                                </div>
                                <button class="view-toggle-btn" onclick="openNewMeetingModal()" title="New Meeting">
                        <svg class="icon" fill="none" stroke="currentColor" viewBox="0 0 24 24" style="width: 1rem; height: 1rem;">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/>
                        </svg>
                        New
                    </button>
                            </div>
                            <!-- Month View -->
                            <div id="monthView" class="meetings-view">
                                <div id="meetingsCalendarGrid"></div>
                            </div>
                            <!-- List View -->
                            <div id="listView" class="meetings-view hidden">
                                <div id="meetingsListContent"></div>
                            </div>
                            <!-- 90 Day View -->
                            <div id="90dayView" class="meetings-view hidden">
                                <div id="meetings90DayContent"></div>
                            </div>
                        </div>
                    </div>

                    <!-- Documents Page -->
                    <div id="documentsPage" class="page-content hidden">
                        <div class="documents-page">
                            <div class="docs-hero">
                                <div>
                                    <div class="docs-hero-title">Documents & Resources</div>
                                    <div class="docs-hero-subtitle">Centralized access to executive assets, KPIs, updates, and reference materials. All links open in a new tab for quick retrieval.</div>
                                </div>
                                <div class="docs-hero-badge">Executive Library</div>
                            </div>

                            <div class="docs-grid">
                                <section class="docs-card">
                                    <div class="docs-card-header">
                                        <div class="docs-card-title">
                                            <svg class="icon-xs" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
                                            </svg>
                                            Admin & Settings
                                        </div>
                                    </div>
                                    <div class="docs-card-body" id="documentsAdmin">
                                        <div class="loading-message">Loading...</div>
                                    </div>
                                </section>

                                <section class="docs-card">
                                    <div class="docs-card-header">
                                        <div class="docs-card-title">
                                            <svg class="icon-xs" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 8v8m-4-5v5m-4-2v2m-2 4h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"/>
                                            </svg>
                                            KPIs & Performance
                                        </div>
                                    </div>
                                    <div class="docs-card-body" id="documentsKPIs">
                                        <div class="loading-message">Loading...</div>
                                    </div>
                                </section>

                                <section class="docs-card">
                                    <div class="docs-card-header">
                                        <div class="docs-card-title">
                                            <svg class="icon-xs" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 21h10a2 2 0 002-2V9.414a1 1 0 00-.293-.707l-5.414-5.414A1 1 0 0012.586 3H7a2 2 0 00-2 2v14a2 2 0 002 2z"/>
                                            </svg>
                                            Executive Updates
                                        </div>
                                    </div>
                                    <div class="docs-card-body">
                                        <div class="table-wrapper">
                                            <table class="deliverables-table">
                                                <thead>
                                                    <tr>
                                                        <th style="width: 35%;">Description</th>
                                                        <th style="width: 20%;">Owner</th>
                                                        <th style="width: 30%;">Link to Materials</th>
                                                        <th style="width: 15%;">Comments</th>
                                                    </tr>
                                                </thead>
                                                <tbody id="documentsExecUpdates">
                                                    <tr><td colspan="4" class="loading-message">Loading...</td></tr>
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                </section>

                                <section class="docs-card">
                                    <div class="docs-card-header">
                                        <div class="docs-card-title">
                                            <svg class="icon-xs" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"/>
                                            </svg>
                                            Document Repository
                                        </div>
                                    </div>
                                    <div class="docs-card-body">
                                        <div class="table-wrapper">
                                            <table class="deliverables-table">
                                                <thead>
                                                    <tr>
                                                        <th style="width: 35%;">Description</th>
                                                        <th style="width: 20%;">Owner</th>
                                                        <th style="width: 30%;">Link to Materials</th>
                                                        <th style="width: 15%;">Comments</th>
                                                    </tr>
                                                </thead>
                                                <tbody id="documentsRepository">
                                                    <tr><td colspan="4" class="loading-message">Loading...</td></tr>
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                </section>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- PDF Export Modal -->
    <div id="pdfExportModal" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Export 2-Week Schedule</h3>
                <button class="close-btn" onclick="closePDFExportModal()"></button>
            </div>
            <div class="modal-body">
                <div style="margin-bottom: 1.5rem;">
                    <label style="display: block; font-size: 0.875rem; font-weight: 600; margin-bottom: 0.5rem;">Report Title</label>
                    <input type="text" id="pdfWeekTitle" value="Two-Week Executive Schedule" style="width: 100%; padding: 0.5rem; border: 1px solid var(--color-slate-300); border-radius: 0.375rem; font-size: 0.875rem;">
                </div>
                
                <div style="margin-bottom: 1.5rem;">
                    <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer;">
                        <input type="checkbox" id="pdfPrepMeetings" checked>
                        <span style="font-size: 0.875rem;">Include prep meeting indicators</span>
                    </label>
                </div>

                <div style="margin-bottom: 1.5rem;">
                    <label style="display: block; font-size: 0.875rem; font-weight: 600; margin-bottom: 0.5rem;">Notes & Commentary (optional)</label>
                    <textarea id="pdfNotes" rows="4" style="width: 100%; padding: 0.75rem; border: 1px solid var(--color-slate-300); border-radius: 0.375rem; font-size: 0.875rem; resize: vertical;" placeholder="Add a short 2-week summary, decisions, or commentary..."></textarea>
                </div>
                
                <div>
                    <label style="display: block; font-size: 0.875rem; font-weight: 600; margin-bottom: 0.75rem;">Select Meetings</label>
                    <label style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.5rem; font-size: 0.875rem; cursor: pointer;">
                        <input type="checkbox" id="pdfSelectAll" checked>
                        <span>Select all</span>
                    </label>
                    <div style="margin-bottom: 0.75rem;">
                        <div style="font-size: 0.75rem; font-weight: 600; color: var(--color-slate-500); margin-bottom: 0.35rem; letter-spacing: 0.03em; text-transform: uppercase;">Select by day</div>
                        <div id="pdfDayFilters" style="display: flex; flex-wrap: wrap; gap: 0.5rem;"></div>
                    </div>
                    <div id="pdfMeetingsList" style="max-height: 300px; overflow-y: auto; border: 1px solid var(--color-slate-200); border-radius: 0.375rem; padding: 0.75rem;">
                        <div class="loading-spinner" style="text-align: center;">Loading meetings...</div>
                    </div>
                </div>
            </div>
            <div class="modal-footer" style="display: flex; gap: 0.75rem; justify-content: flex-end; padding: 1rem 1.5rem; border-top: 1px solid var(--color-slate-200);">
                <button class="btn-secondary" onclick="closePDFExportModal()">Cancel</button>
                <button class="btn-secondary" onclick="previewPDFExport(this)">Preview</button>
                <button class="btn-primary" onclick="generatePDFExport(this)">
                    <svg class="icon" fill="none" stroke="currentColor" viewBox="0 0 24 24" style="width: 1rem; height: 1rem; margin-right: 0.5rem;">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"/>
                    </svg>
                    Export PDF
                </button>
            </div>
        </div>
    </div>

<script>
// ============================================================================
// GLOBAL STATE
// ============================================================================

let dashboardData = {
    exec1Deliverables: [],
    exec2Deliverables: [],
    meetings: [],
    recurringMeetings: [],
    adminLinks: [],
    documentRepoLinks: [],
    kpiLinks: [],
    executiveUpdates: [],
    completedItems: []
};

let currentMonth = new Date();
let currentPage = 'overview';

// Agenda Builder State
let agendaModalOpen = false;
let selectedRecurringMeetingId = '';
let selectedRecurringMeetingName = '';
let selectedAgendaDate = '';
let agendaTopics = [''];
let agendaLink = '';

// ============================================================================
// INITIALIZATION
// ============================================================================

document.addEventListener('DOMContentLoaded', function() {
    console.log('Dashboard initializing...');
    initializeCalendar();
    
    // Check if google is defined (Apps Script environment) or not (Preview/Local)
    if (typeof google === 'undefined' || typeof google.script === 'undefined') {
        console.warn(' Google Apps Script environment not detected. Using mock data for preview.');
        
        // Mock Data for Preview
        const mockDashboardData = {
            exec1Deliverables: [
                { description: "Q1 Financial Review", eta: "Feb 15", owner: "Sarah M.", daysRemainingText: "14d", urgency: "medium", isHotTopic: false },
                { description: "Board Deck Finalization", eta: "Feb 02", owner: "Mike R.", daysRemainingText: "2d", urgency: "critical", isHotTopic: true }
            ],
            exec2Deliverables: [
                { description: "Compliance Audit", eta: "Mar 01", owner: "Legal", daysRemainingText: "28d", urgency: "low", isHotTopic: false }
            ],
            meetings: [
                { id: "m1", title: "Weekly Staff Sync", time: "09:00", date: new Date().toISOString().split('T')[0], category: "meeting" },
                { id: "m2", title: "Project Alpha Review", time: "14:00", date: new Date().toISOString().split('T')[0], category: "deep-work" }
            ],
            recurringMeetings: [
                { id: "r1", name: "Weekly Staff Sync" },
                { id: "r2", name: "Monthly Board Prep" }
            ],
            adminLinks: [
                { name: "Expense Portal", url: "#" },
                { name: "Travel Booking", url: "#" }
            ],
            kpiLinks: [
                { name: "Sales Dashboard", url: "#" }
            ],
            executiveUpdates: [
                { name: "Q4 Summary", url: "#", dateAdded: "Jan 15, 2026" }
            ],
            completedItems: [
                { title: "Budget Approval", dateCompleted: "Jan 20, 2026", status: "Approved" }
            ]
        };

        // Initialize mock google object
        window.google = {
            script: {
                run: {
                    withSuccessHandler: function(success) {
                        return {
                            withFailureHandler: function(failure) {
                                return {
                                    getAllDashboardData: function() {
                                        console.log(' Mocking getAllDashboardData...');
                                        setTimeout(() => success(mockDashboardData), 800);
                                    },
                                    createAgenda: function(data) {
                                        console.log(' Mocking createAgenda...', data);
                                        setTimeout(() => success({
                                            success: true,
                                            documentName: 'Agenda - ' + data.meetingName,
                                            documentUrl: '#'
                                        }), 800);
                                    }
                                };
                            }
                        };
                    }
                }
            }
        };
    }

    loadDashboardData();
    
    // Render calendar shell immediately for the Meetings page
    try {
        renderMeetingsCalendar();
    } catch (e) {
        console.error(' Error rendering meetings calendar:', e);
    }
    
    // Auto-refresh every 5 minutes
    setInterval(loadDashboardData, 300000);
});

// ============================================================================
// DATA LOADING
// ============================================================================

function loadDashboardData() {
    console.log('Loading dashboard data from Google Sheets...');
    
    // Set a timeout to detect if backend isn't responding
    const timeout = setTimeout(() => {
        console.error(' TIMEOUT: Backend is not responding after 30 seconds!');
        showError('Backend timeout. Please check:<br>1. Apps Script deployment is active<br>2. Sheet IDs in CONFIG are correct<br>3. Run testDataRetrieval() in Apps Script');
    }, 30000);
    
    google.script.run
        .withSuccessHandler(function(data) {
            clearTimeout(timeout);
            onDataLoaded(data);
        })
        .withFailureHandler(function(error) {
            clearTimeout(timeout);
            onDataError(error);
        })
        .getAllDashboardData();
}

function refreshDashboard() {
    try {
        loadDashboardData();
    } catch (e) {
        console.error('Refresh failed:', e);
    }
}

function onDataLoaded(data) {
    console.log(' Data received from backend:', data);
    
    // Check if data exists
    if (!data || data === null || typeof data === 'undefined') {
        console.error(' Data is null/undefined - backend sent nothing');
        showError('Backend returned no data. Backend is working but data not reaching frontend. Try: 1) Redeploy 2) Clear cache (Ctrl+Shift+R) 3) New incognito tab');
        return;
    }
    
    // Check for error property
    if (data.error) {
        console.error(' Backend error:', data.error);
        showError('Backend error: ' + data.error);
        return;
    }
    
    console.log(' Data is valid, starting render...');
    dashboardData = data;
    
    // Render all sections with error handling
    try {
        console.log('Rendering alerts...');
        renderAlerts();
        console.log(' Alerts rendered');
    } catch (e) {
        console.error(' Error rendering alerts:', e);
    }

    try {
        console.log('Rendering deliverables...');
        renderDeliverables();
        console.log(' Deliverables rendered');
        
        // Attach click handlers to deliverable rows
        setTimeout(() => {
            attachDeliverableClickHandlers();
            console.log(' Deliverable click handlers attached');
        }, 100);
    } catch (e) {
        console.error(' Error rendering deliverables:', e);
    }
    
    try {
        console.log('Rendering schedule...');
        renderSchedule();
        console.log(' Schedule rendered');
    } catch (e) {
        console.error(' Error rendering schedule:', e);
    }

    try {
        initMeetingSearch();
    } catch (e) {
        console.error(' Error initializing meeting search:', e);
    }
    
    try {
        console.log('Rendering sidebar links...');
        renderSidebarLinks();
        console.log(' Sidebar links rendered');
    } catch (e) {
        console.error(' Error rendering sidebar links:', e);
    }
    
    try {
        console.log('Rendering recurring meetings dropdown...');
        renderRecurringMeetingsDropdown();
        console.log(' Recurring meetings dropdown rendered');
    } catch (e) {
        console.error(' Error rendering recurring meetings dropdown:', e);
    }

    try {
        if (currentPage === 'meetings') {
            switchMeetingsView(currentMeetingsView);
        }
    } catch (e) {
        console.error(' Error rendering meetings view:', e);
    }
    
    console.log(' All rendering complete!');
}

let meetingSearchTimer = null;
function initMeetingSearch() {
    const input = document.getElementById('meetingSearchInput');
    const results = document.getElementById('meetingSearchResults');
    if (!input || !results) return;
    
    const renderResults = (query) => {
        const q = query.trim().toLowerCase();
        if (!q) {
            results.innerHTML = '<div style="color: var(--color-slate-500); font-size: 0.85rem; padding: 0.5rem;">Start typing to search meetings</div>';
            results.style.display = 'block';
            return;
        }
        
        const meetings = dashboardData.meetings || [];
        const matches = meetings.filter(m => {
            const hay = [
                m.title,
                m.description,
                m.attendees,
                m.dateFormatted,
                m.date,
                m.time
            ].join(' ').toLowerCase();
            return hay.includes(q);
        }).slice(0, 25);
        
        if (matches.length === 0) {
            results.innerHTML = '<div style="color: var(--color-slate-500); font-size: 0.85rem; padding: 0.5rem;">No matches found.</div>';
            results.style.display = 'block';
            return;
        }
        
        results.innerHTML = matches.map(m => `
            <div class="agenda-hoverable" style="padding: 0.5rem 0.25rem; border-bottom: 1px solid var(--color-slate-100); cursor: pointer;" onclick="openMeetingModal('${m.id}'); document.getElementById('meetingSearchResults').style.display='none';">
                <div style="font-weight: 600; font-size: 0.9rem; color: var(--color-slate-800);">${escapeHtml(m.title)} ${renderAgendaBadge(m)}</div>
                <div style="font-size: 0.75rem; color: var(--color-slate-500);">
                    ${m.dateFormatted || m.date}  ${formatTimeStandard(m.time)} ${m.isHotTopic ? '  Hot Topic' : ''}
                </div>
                ${m.attendees ? `<div style="font-size: 0.7rem; color: var(--color-slate-400); margin-top: 0.15rem;">${escapeHtml(m.attendees)}</div>` : ''}
            </div>
        `).join('');
        results.style.display = 'block';
    };
    
    input.oninput = () => {
        if (meetingSearchTimer) clearTimeout(meetingSearchTimer);
        meetingSearchTimer = setTimeout(() => renderResults(input.value), 150);
    };

    input.onfocus = () => renderResults(input.value);
    document.addEventListener('click', (e) => {
        if (!results || !input) return;
        if (!results.contains(e.target) && e.target !== input) {
            results.style.display = 'none';
        }
    });
    
    renderResults('');
}

function onDataError(error) {
    console.error('Failed to load data:', error);
    showError('Network error. Please refresh the page.');
}

function showError(message) {
    const sections = ['deliverablesSection', 'scheduleSection'];
    sections.forEach(id => {
        const el = document.getElementById(id);
        if (el) {
            el.innerHTML = `<div class="card" style="background-color: var(--color-red-50); border-color: var(--color-red-200); color: var(--color-red-700);">
                <p><strong>Error:</strong> ${message}</p>
            </div>`;
        }
    });
}

// ============================================================================
// DELIVERABLES RENDERING
// ============================================================================

function renderAlerts() {
    const banner = document.getElementById('alertBanner');
    const content = document.getElementById('alertContent');
    
    if (!dashboardData.alerts || dashboardData.alerts.length === 0) {
        banner.style.display = 'none';
        return;
    }
    
    banner.style.display = 'block';
    // Join alerts with a separator
    content.innerHTML = dashboardData.alerts.join(' &nbsp;&nbsp;&nbsp;&nbsp;  &nbsp;&nbsp;&nbsp;&nbsp; ');
    
    // Adjust animation speed based on content length
    const textLength = content.innerText.length;
    const duration = Math.max(20, textLength / 10); // Roughly 10 chars per second
    content.style.animationDuration = `${duration}s`;
}

function renderDeliverables() {
    const container = document.getElementById('deliverablesSection');
    
    const html = `
        <div class="deliverables-grid">
        <!-- Exec 1 Deliverables -->
        <div class="card">
            <div class="deliverables-section-header">
                <h2>
                    <svg class="icon" fill="none" stroke="currentColor" viewBox="0 0 24 24" style="width: 1.5rem; height: 1.5rem;">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/>
                    </svg>
                    Sarcone's Upcoming Deliverables
                </h2>
                <button class="icon-btn" title="Add Deliverable" onclick="openAddItemModal('exec1')">
                    <svg class="icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/>
                    </svg>
                </button>
            </div>
            <div class="table-wrapper">
                ${renderDeliverablesTable(dashboardData.exec1Deliverables, "exec1")}
            </div>
        </div>

        <!-- Exec 2 Governance Deliverables -->
        <div class="card">
            <div class="deliverables-section-header">
                <h2>
                    <svg class="icon" fill="none" stroke="currentColor" viewBox="0 0 24 24" style="width: 1.5rem; height: 1.5rem;">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"/>
                    </svg>
                    DK's Governance Upcoming Deliverables
                </h2>
                <button class="icon-btn" title="Add Deliverable" onclick="openAddItemModal('exec2')">
                    <svg class="icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/>
                    </svg>
                </button>
            </div>
            <div class="table-wrapper">
                ${renderDeliverablesTable(dashboardData.exec2Deliverables, "exec2")}
            </div>
        </div>
        </div>
    `;
    
    container.innerHTML = html;
}

function renderDeliverablesTable(deliverables) {
    if (!deliverables || deliverables.length === 0) {
        return '<p style="color: var(--color-slate-500); padding: 2rem; text-align: center;">No deliverables found.</p>';
    }
    
    return `
        <table class="deliverables-table">
            <thead>
                <tr>
                    <th style="width: 35%;">DESCRIPTION</th>
                    <th style="width: 12%;">ETA</th>
                    <th style="width: 18%;">OWNER</th>
                    <th style="width: 20%;">LINK TO MATERIALS</th>
                    <th style="width: 15%;">DAYS LEFT</th>
                </tr>
            </thead>
            <tbody>
                ${deliverables.filter(item => item.description && item.description.trim() !== '').map(item => `
                    <tr class="deliverable-row" 
                        data-id="${item.id || ''}" 
                        data-description="${item.description || ''}" 
                        data-eta="${item.eta || ''}" 
                        data-owner="${item.owner || ''}" 
                        data-link="${item.linkedMaterials || ''}" 
                        data-subtext="${item.comment || ''}" 
                        style="cursor: pointer;">
                        <td>
                            <span class="item-description" style="display: inline;">${escapeHtml(item.description)}</span>
                            ${item.comment ? `<div class="item-subtext" style="font-style: italic; color: var(--color-slate-500); margin-top: 0.25rem; font-size: 0.75rem;">${escapeHtml(item.comment)}</div>` : ''}
                        </td>
                        <td style="white-space: nowrap;">${item.eta && item.eta.trim() ? item.eta : ''}</td>
                        <td>${escapeHtml(item.owner) || ''}</td>
                        <td>
                            ${item.linkedMaterials ? `
                                <a href="${item.linkedMaterials}" target="_blank" class="action-link" style="color: var(--color-red-600); text-decoration: none; display: inline-flex; align-items: center; gap: 0.25rem; font-size: 0.875rem;" onclick="event.stopPropagation();">
                                    <svg class="icon" style="width: 14px; height: 14px;" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"/>
                                    </svg>
                                    Open
                                </a>
                            ` : ''}
                        </td>
                        <td>
                            ${item.daysRemainingText ? `<span class="remaining-badge ${item.urgency === 'none' ? 'badge-text' : item.urgency}" style="font-size: 0.75rem; padding: 0.125rem 0.5rem;">${item.daysRemainingText}</span>` : ''}
                        </td>
                    </tr>
                `).join('')}
            </tbody>
        </table>
    `;
}


// Helper function to attach click handlers to deliverable rows
function attachDeliverableClickHandlers() {
    const rows = document.querySelectorAll('.deliverable-row');
    rows.forEach(row => {
        row.onclick = function() {
            const id = this.dataset.id;
            const description = this.dataset.description;
            const eta = this.dataset.eta;
            const owner = this.dataset.owner;
            const link = this.dataset.link;
            const subtext = this.dataset.subtext;
            
            openDeliverableModal(id, description, eta, owner, link, subtext);
        };
    });
}


// ============================================================================
// SCHEDULE RENDERING
// ============================================================================

/**
 * Helper function to detect overlapping timestamps
 * Returns true if two meetings overlap
 */
function hasTimeConflict(meeting1, meeting2) {
    if (meeting1.date !== meeting2.date) return false;
    
    const time1 = meeting1.time24 || meeting1.time;
    const time2 = meeting2.time24 || meeting2.time;
    if (!time1 || !time2) return false;
    
    const start1 = timeToMinutes(time1);
    const start2 = timeToMinutes(time2);
    
    // Assume 60 minute duration if not specified
    const duration1 = Number(meeting1.duration) || 60;
    const duration2 = Number(meeting2.duration) || 60;
    
    const end1 = start1 + duration1;
    const end2 = start2 + duration2;
    
    // Check for overlap
    return (start1 < end2 && end1 > start2);
}

function renderSchedule() {
    const container = document.getElementById('scheduleSection');
    
    if (!dashboardData.meetings || dashboardData.meetings.length === 0) {
        container.innerHTML = `
            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">
                        <svg class="icon card-title-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/>
                        </svg>
                        Executive Schedule - 2 Week View
                    </h2>
                </div>
                <p style="color: var(--color-slate-500); padding: 2rem; text-align: center;">No upcoming meetings found.</p>
            </div>
        `;
        return;
    }
    
    // Group meetings by date
    const meetingsByDate = {};
    dashboardData.meetings.forEach(meeting => {
        if (!meetingsByDate[meeting.date]) {
            meetingsByDate[meeting.date] = [];
        }
        meetingsByDate[meeting.date].push(meeting);
    });
    
    const { firstWeekDates, secondWeekDates } = getTwoWeekScheduleDates();
    
        const html = `
        <div class="card">
            <div class="card-header">
                <h2 class="card-title">
                    <svg class="icon card-title-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/>
                    </svg>
                    Executive Schedule - 2 Week View
                </h2>
            </div>
            <div class="schedule-wrapper">
                ${renderScheduleGrid(firstWeekDates, meetingsByDate, 'Week 1', true)}
                ${secondWeekDates.length > 0 ? renderScheduleGrid(secondWeekDates, meetingsByDate, 'Week 2', false) : ''}
            </div>
        </div>
    `;
    
    container.innerHTML = html;
}

function getTwoWeekScheduleDates() {
    // Generate 2 weeks of workdays (Mon-Fri) starting from February 2, 2026 (hardcoded)
    const startDate = new Date('2026-02-02T00:00:00'); // Hardcoded to February 2, 2026
    const monday = new Date(startDate);
    
    const firstWeekDates = [];
    const secondWeekDates = [];
    
    for (let i = 0; i < 5; i++) {
        const d = new Date(monday);
        d.setDate(monday.getDate() + i);
        firstWeekDates.push(d.toISOString().split('T')[0]);
    }
    for (let i = 7; i < 12; i++) {
        const d = new Date(monday);
        d.setDate(monday.getDate() + i);
        secondWeekDates.push(d.toISOString().split('T')[0]);
    }
    
    return {
        firstWeekDates,
        secondWeekDates,
        allDates: [...firstWeekDates, ...secondWeekDates]
    };
}

function renderScheduleGrid(dates, meetingsByDate, weekLabel, showExport) {
    if (dates.length === 0) return '';
    
    const dayNames = ['MON', 'TUE', 'WED', 'THU', 'FRI'];
    
    return `
        <div style="margin-bottom: 2rem;">
            <div style="display: grid; grid-template-columns: repeat(5, 1fr); gap: 1rem; margin-bottom: 0.5rem; align-items: center;">
                <div style="grid-column: 1 / span 4; font-size: 0.75rem; font-weight: 700; color: var(--color-slate-600); letter-spacing: 0.08em; text-transform: uppercase;">${weekLabel}</div>
                <div style="grid-column: 5; text-align: right;">
                    ${showExport ? `
                        <button class="btn-secondary" style="padding: 0.35rem 0.75rem; font-size: 0.75rem;" onclick="openPDFExportModal()">
                            Export
                        </button>
                    ` : ''}
                </div>
            </div>
            <div style="display: grid; grid-template-columns: repeat(5, 1fr); gap: 1rem;">
                ${dates.map((date, idx) => {
                    const d = new Date(date + 'T00:00:00');
                    const dayName = dayNames[d.getDay() - 1] || dayNames[idx % 5];
                    const dayNumber = d.getDate();
                    const isToday = isDateToday(date);
                    const dayMeetings = meetingsByDate[date] || [];
                    
                    // Sort meetings by time
                    dayMeetings.sort((a, b) => timeToMinutes(a.time24 || a.time) - timeToMinutes(b.time24 || b.time));

                    return `
                        <div class="schedule-day${new Date(date + 'T00:00:00') < new Date(new Date().setHours(0,0,0,0)) ? ' past' : ''}" style="background: white; border: 1px solid var(--color-slate-200); border-radius: 0.75rem; overflow: hidden; display: flex; flex-direction: column; min-height: 240px; box-shadow: var(--shadow-soft);">
                            <div style="padding: 0.6rem; text-align: center; border-bottom: 1px solid var(--color-slate-200); ${isToday ? 'background-color: var(--color-red-700); color: white;' : 'background-color: var(--color-slate-50); color: var(--color-slate-600);'}">
                                <div style="font-size: 0.5rem; font-weight: 700; text-transform: uppercase; letter-spacing: 0.05em;">${dayName}</div>
                                <div style="font-size: 1rem; font-weight: 800; margin-top: 0.15rem;">${dayNumber}</div>
                            </div>
                            <div style="padding: 0.75rem; flex: 1; display: flex; flex-direction: column; gap: 0.75rem;">
                                ${dayMeetings.length > 0 ? dayMeetings.map(m => {
                                    const hasConflict = dayMeetings.some(other => other.id !== m.id && hasTimeConflict(m, other));
                                    const conflictStyle = hasConflict ? 'background-color: var(--color-red-100); border-left: 3px solid var(--color-red-600);' : '';
                    const hotClass = getMeetingColorClass(m);
                    return `
                                    <div class="schedule-item agenda-hoverable ${m.category && m.category.toLowerCase().includes('work') ? 'deep-work' : ''} ${hotClass}" 
                                         style="margin-bottom: 0; cursor: pointer; border: 1px solid var(--color-slate-100); box-shadow: 0 1px 2px rgba(0,0,0,0.05); padding: 0.5rem; border-radius: 0; ${conflictStyle}"
                                         onclick="openMeetingDetails('${m.id}')">
                                        <div style="display: flex; align-items: center; gap: 0.5rem;">
                                            <div style="font-weight: 700; font-size: 0.7rem; color: var(--color-slate-900); white-space: nowrap;">${formatTimeStandard(m.time)}</div>
                                            <div style="font-size: 0.7rem; color: var(--color-slate-600); white-space: nowrap; overflow: hidden; text-overflow: ellipsis; flex: 1;">${escapeHtml(m.title)}</div>
                                            ${renderHotTopicIcon(m)}
                                            ${renderAgendaBadge(m)}
                                            ${m.prepRequired ? `
                                                <svg class="icon-xs" style="color: var(--color-blue-600); width: 10px; height: 10px;" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/>
                                                </svg>
                                            ` : ''}
                                        </div>
                                    </div>
                                `;
                                }).join('') : `
                                    <div style="flex: 1; display: flex; align-items: center; justify-content: center; color: var(--color-slate-300); font-size: 0.75rem; font-style: italic;">
                                        No events
                                    </div>
                                `}
                            </div>
                        </div>
                    `;
                }).join('')}
            </div>
        </div>
    `;
}

function isDateToday(dateStr) {
    const today = new Date();
    const date = new Date(dateStr + 'T00:00:00');
    return date.getDate() === today.getDate() &&
           date.getMonth() === today.getMonth() &&
           date.getFullYear() === today.getFullYear();
}

function timeToMinutes(timeStr) {
    if (!timeStr) return 1441;
    const str = String(timeStr).trim();
    const ampmMatch = str.match(/^(\d{1,2})(?::(\d{2}))?\s*(AM|PM)$/i);
    if (ampmMatch) {
        let hour = parseInt(ampmMatch[1], 10);
        const minute = parseInt(ampmMatch[2] || '0', 10);
        const ampm = ampmMatch[3].toUpperCase();
        if (ampm === 'PM' && hour !== 12) hour += 12;
        if (ampm === 'AM' && hour === 12) hour = 0;
        return hour * 60 + minute;
    }
    const militaryMatch = str.match(/^(\d{1,2}):(\d{2})/);
    if (militaryMatch) {
        const hour = parseInt(militaryMatch[1], 10);
        const minute = parseInt(militaryMatch[2], 10);
        return hour * 60 + minute;
    }
    return 1441;
}

function formatTimeStandard(timeStr) {
    if (!timeStr) return '';
    const str = String(timeStr).trim();
    const ampmMatch = str.match(/^(\d{1,2})(?::(\d{2}))?\s*(AM|PM)$/i);
    if (ampmMatch) {
        const hour = parseInt(ampmMatch[1], 10);
        const minute = (ampmMatch[2] || '00').padStart(2, '0');
        const ampm = ampmMatch[3].toUpperCase();
        return `${hour}:${minute} ${ampm}`;
    }
    const militaryMatch = str.match(/^(\d{1,2}):(\d{2})/);
    if (militaryMatch) {
        let hour = parseInt(militaryMatch[1], 10);
        const minute = militaryMatch[2];
        const ampm = hour >= 12 ? 'PM' : 'AM';
        hour = hour % 12;
        hour = hour ? hour : 12;
        return `${hour}:${minute} ${ampm}`;
    }
    return str;
}

function renderHotTopicBadge(meeting) {
    if (!meeting || !meeting.isHotTopic) return '';
    const level = meeting.hotTopicLevel || '';
    const label = level === 'urgent' ? 'Urgent/Critical' : (level === 'must-attend' ? 'Must Attend' : 'Hot Topic');
    const cls = level === 'urgent' ? 'hot-topic-urgent' : (level === 'must-attend' ? 'hot-topic-attend' : 'hot-topic-default');
    return `<span class="hot-topic-badge ${cls}"> ${label}</span>`;
}

function renderHotTopicIcon(meeting) {
    if (!meeting || !meeting.isHotTopic) return '';
    const level = meeting.hotTopicLevel || '';
    const label = level === 'urgent' ? 'Urgent/Critical' : (level === 'must-attend' ? 'Must Attend' : 'Hot Topic');
    const cls = level === 'urgent' ? 'hot-topic-urgent' : (level === 'must-attend' ? 'hot-topic-attend' : 'hot-topic-default');
    const icon = level === 'urgent' ? '' : (level === 'must-attend' ? '' : '');
    return `<span class="hot-topic-icon ${cls}" title="${label}" aria-label="${label}">${icon}</span>`;
}

function renderAgendaBadge(meeting) {
    if (!meeting || !meeting.deliverableLink) return '';
    return `<span class="agenda-badge" title="Agenda attached" aria-label="Agenda attached"></span>`;
}

function getMeetingColorClass(meeting) {
    if (!meeting) return '';
    const id = String(meeting.colorId || '').trim();
    if (!id) {
        if (meeting.hotTopicLevel === 'urgent') return 'meeting-color-11';
        if (meeting.hotTopicLevel === 'must-attend') return 'meeting-color-6';
        if (meeting.isHotTopic) return 'meeting-hot-default';
        return '';
    }
    switch (id) {
        case '11': return 'meeting-color-11';
        case '6': return 'meeting-color-6';
        case '7': return 'meeting-color-7';
        case '5': return 'meeting-color-5';
        case '10': return 'meeting-color-10';
        case '9': return 'meeting-color-9';
        case '8': return 'meeting-color-8';
        default: return '';
    }
}

// ============================================================================
// SIDEBAR LINKS RENDERING
// ============================================================================

// ============================================================================
// DOCUMENTS PAGE RENDERING
// ============================================================================

function renderDocumentsPage() {
    // Admin Links
    const adminContainer = document.getElementById('documentsAdmin');
    if (dashboardData.adminLinks && dashboardData.adminLinks.length > 0) {
        adminContainer.innerHTML = `
            <div style="display: flex; flex-direction: column; gap: 0.75rem;">
                ${dashboardData.adminLinks.map(link => `
                    <a href="${link.url || '#'}" target="_blank" style="display: flex; align-items: center; gap: 0.75rem; padding: 0.75rem; background: var(--color-slate-50); border-radius: 0.5rem; text-decoration: none; color: var(--color-slate-700); transition: all 0.2s;" onmouseover="this.style.background='var(--color-slate-100)'" onmouseout="this.style.background='var(--color-slate-50)'">
                        <svg class="icon-xs" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
                        </svg>
                        <div style="flex: 1;">
                            <div style="font-weight: 600; font-size: 0.875rem;">${escapeHtml(link.name)}</div>
                        </div>
                        <svg class="icon-xs" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"/>
                        </svg>
                    </a>
                `).join('')}
            </div>
        `;
    } else {
        adminContainer.innerHTML = '<p style="color: var(--color-slate-500); text-align: center; padding: 2rem;">No admin links configured</p>';
    }
    
    // KPI Links
    const kpiContainer = document.getElementById('documentsKPIs');
    if (dashboardData.kpiLinks && dashboardData.kpiLinks.length > 0) {
        kpiContainer.innerHTML = `
            <div style="display: flex; flex-direction: column; gap: 0.75rem;">
                ${dashboardData.kpiLinks.map(link => `
                    <a href="${link.url || '#'}" target="_blank" style="display: flex; align-items: center; gap: 0.75rem; padding: 0.75rem; background: var(--color-slate-50); border-radius: 0.5rem; text-decoration: none; color: var(--color-slate-700); transition: all 0.2s;" onmouseover="this.style.background='var(--color-slate-100)'" onmouseout="this.style.background='var(--color-slate-50)'">
                        <svg class="icon-xs" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 8v8m-4-5v5m-4-2v2m-2 4h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"/>
                        </svg>
                        <div style="flex: 1;">
                            <div style="font-weight: 600; font-size: 0.875rem;">${escapeHtml(link.name)}</div>
                        </div>
                        <svg class="icon-xs" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"/>
                        </svg>
                    </a>
                `).join('')}
            </div>
        `;
    } else {
        kpiContainer.innerHTML = '<p style="color: var(--color-slate-500); text-align: center; padding: 2rem;">No KPI links configured</p>';
    }
    
    // Executive Updates
    const updatesContainer = document.getElementById('documentsExecUpdates');
    if (dashboardData.executiveUpdates && dashboardData.executiveUpdates.length > 0) {
        updatesContainer.innerHTML = dashboardData.executiveUpdates.map(update => `
            <tr>
                <td class="item-description">${escapeHtml(update.description || update.name || update.title)}</td>
                <td>${escapeHtml(update.owner || '')}</td>
                <td>
                    <a href="${update.url || update.link || '#'}" target="_blank" class="action-link">
                        <svg class="icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"/>
                        </svg>
                    </a>
                </td>
                <td style="font-size: 0.75rem; color: var(--color-slate-500);">${escapeHtml(update.comment || '')}</td>
            </tr>
        `).join('');
    } else {
        updatesContainer.innerHTML = '<tr><td colspan="4" style="text-align: center; padding: 2rem; color: var(--color-slate-400);">No updates available</td></tr>';
    }
    
    // Document Repository Table (columns A, C, D, G = Description, Owner, Link, Comments)
    const docRepoTable = document.getElementById('documentsRepository');
    if (dashboardData.documentRepoLinks && dashboardData.documentRepoLinks.length > 0) {
        docRepoTable.innerHTML = dashboardData.documentRepoLinks.map(doc => `
            <tr style="cursor: pointer;">
                <td>
                    <div style="font-weight: 600;">${escapeHtml(doc.name || doc.description)}</div>
                    ${doc.comment ? `<div style="font-size: 0.75rem; color: var(--color-slate-500); margin-top: 0.25rem;">${escapeHtml(doc.comment)}</div>` : ''}
                </td>
                <td>${escapeHtml(doc.owner) || ''}</td>
                <td>
                    ${doc.url || doc.link ? `
                        <a href="${doc.url || doc.link}" target="_blank" style="color: var(--color-red-600); text-decoration: none; display: inline-flex; align-items: center; gap: 0.25rem; font-size: 0.875rem;" onclick="event.stopPropagation();">
                            <svg class="icon" style="width: 14px; height: 14px;" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"/>
                            </svg>
                            Open
                        </a>
                    ` : ''}
                </td>
                <td>${doc.comment ? `<span style="font-size: 0.875rem;">${escapeHtml(doc.comment)}</span>` : ''}</td>
            </tr>
        `).join('');
    } else {
        docRepoTable.innerHTML = '<tr><td colspan="4" style="text-align: center; padding: 2rem; color: var(--color-slate-500);">No documents found</td></tr>';
    }
}

function renderSidebarLinks() {
    // Admin Links
    const adminContainer = document.getElementById('adminLinks');
    if (dashboardData.adminLinks && dashboardData.adminLinks.length > 0) {
        adminContainer.innerHTML = dashboardData.adminLinks.map(link => `
            <a href="${link.url || '#'}" target="_blank" class="sidebar-link">
                <svg class="icon-xs" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
                </svg>
                ${escapeHtml(link.name)}
            </a>
        `).join('');
    } else {
        adminContainer.innerHTML = '<p style="font-size: 0.75rem; color: var(--color-slate-400); padding: 0.5rem;">No links configured</p>';
    }
    
    // KPI Links
    const kpiContainer = document.getElementById('kpiLinks');
    if (dashboardData.kpiLinks && dashboardData.kpiLinks.length > 0) {
        kpiContainer.innerHTML = dashboardData.kpiLinks.map(link => `
            <a href="${link.url || '#'}" target="_blank" class="sidebar-link">
                <svg class="icon-xs" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 8v8m-4-5v5m-4-2v2m-2 4h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"/>
                </svg>
                ${escapeHtml(link.name)}
            </a>
        `).join('');
    } else {
        kpiContainer.innerHTML = '<p style="font-size: 0.75rem; color: var(--color-slate-400); padding: 0.5rem;">No links configured</p>';
    }
    
    // Executive Updates
    const updatesContainer = document.getElementById('executiveUpdates');
    if (dashboardData.executiveUpdates && dashboardData.executiveUpdates.length > 0) {
        updatesContainer.innerHTML = dashboardData.executiveUpdates.map(update => `
            <a href="${update.url || update.link || '#'}" target="_blank" class="sidebar-link">
                <svg class="icon-xs" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 21h10a2 2 0 002-2V9.414a1 1 0 00-.293-.707l-5.414-5.414A1 1 0 0012.586 3H7a2 2 0 00-2 2v14a2 2 0 002 2z"/>
                </svg>
                <div style="flex: 1;">
                    <div style="font-weight: 600;">${escapeHtml(update.name)}</div>
                </div>
            </a>
        `).join('');
    } else {
        updatesContainer.innerHTML = '<p style="font-size: 0.75rem; color: var(--color-slate-400); padding: 0.5rem;">No updates yet</p>';
    }
    
    // Completed Items
    const completedContainer = document.getElementById('completedItems');
    if (dashboardData.completedItems && dashboardData.completedItems.length > 0) {
        completedContainer.innerHTML = dashboardData.completedItems.map(item => `
            <div class="completed-item">
                <svg class="completed-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
                </svg>
                <div style="flex: 1;">
	                    <div class="completed-item-title">${escapeHtml(item.description || item.title)}</div>
	                    <div class="completed-item-date">${item.eta || ''}${item.status ? `<span class="completed-badge">${item.status}</span>` : ''}</div>
                </div>
            </div>
        `).join('');
    } else {
        completedContainer.innerHTML = '<p style="font-size: 0.75rem; color: var(--color-slate-400); padding: 0.5rem;">No completed items yet</p>';
    }

    
    // Document Repository Links (limit to first 10)
    const docRepoContainer = document.getElementById('documentRepoLinks');
    if (dashboardData.documentRepoLinks && dashboardData.documentRepoLinks.length > 0) {
        docRepoContainer.innerHTML = dashboardData.documentRepoLinks.slice(0, 10).map(doc => `
            <a href="${doc.url || doc.link || '#'}" target="_blank" class="sidebar-link">
                <svg class="icon-xs" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
                </svg>
                <div style="flex: 1;">
                    <div style="font-weight: 600;">${escapeHtml(doc.name || doc.description)}</div>
                    ${doc.owner ? `<div style="font-size: 0.625rem; color: var(--color-slate-400);">Owner: ${escapeHtml(doc.owner)}</div>` : ''}
                </div>
            </a>
        `).join('');
    } else {
        docRepoContainer.innerHTML = '<p style="font-size: 0.75rem; color: var(--color-slate-400); padding: 0.5rem;">No documents available</p>';
    }
}

// ============================================================================
// DOCUMENT REPOSITORY RENDERING
// ============================================================================

function renderDocumentRepository() {
    const container = document.getElementById('documentRepository');
    
    const html = `
        <div class="mt-3">
            ${renderDocSection('Admin & Settings', dashboardData.adminLinks)}
            ${renderDocSection('KPIs & Performance', dashboardData.kpiLinks)}
            ${renderDocSection('Executive Updates', dashboardData.executiveUpdates)}
            ${renderDocSection('Document Repository', dashboardData.documentRepoLinks)}
        </div>
    `;
    
    container.innerHTML = html;
}

function renderDocSection(title, items) {
    return `
        <div style="margin-bottom: 2rem;">
            <h3 style="font-size: 1rem; font-weight: 700; color: var(--color-slate-800); margin-bottom: 1rem; padding-bottom: 0.5rem; border-bottom: 2px solid var(--color-red-600); display: inline-block;">${title}</h3>
            <table class="deliverables-table">
                <thead>
                    <tr>
                        <th>Description</th>
                        <th>Owner</th>
                        <th>Materials</th>
                        <th>Comments</th>
                    </tr>
                </thead>
                <tbody>
                    ${items && items.length > 0 ? items.map(item => `
                        <tr>
                            <td class="item-description">${escapeHtml(item.description || item.name || item.title)}</td>
                            <td>${escapeHtml(item.owner || '')}</td>
                            <td>
                                <a href="${escapeHtml(item.link || item.url || '#')}" target="_blank" class="action-link">
                                    <svg class="icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"/>
                                    </svg>
                                </a>
                            </td>
                            <td style="font-size: 0.75rem; color: var(--color-slate-500);">${escapeHtml(item.comment || '')}</td>
                        </tr>
                    `).join('') : '<tr><td colspan="5" style="text-align: center; padding: 2rem; color: var(--color-slate-400);">No items found</td></tr>'}
                </tbody>
            </table>
        </div>
    `;
}

function renderMeetingsScheduling() {
    const container = document.getElementById('meetingsSchedulingContent');
    const meetings = dashboardData.meetings || [];
    
    let html = `
        <table class="deliverables-table">
            <thead>
                <tr>
                    <th>Meeting Name</th>
                    <th>Date</th>
                    <th>Time</th>
                    <th>Attendees</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                ${meetings.length > 0 ? meetings.map(m => {
                    const colorClass = getMeetingColorClass(m);
                    return `
                    <tr>
                        <td><div class="item-description meeting-title-card agenda-hoverable ${colorClass}">${escapeHtml(m.title)} ${renderAgendaBadge(m)}</div></td>
                        <td>${m.dateFormatted}</td>
                        <td>${formatTimeStandard(m.time)}</td>
                        <td style="font-size: 0.75rem;">${escapeHtml(m.attendees)}</td>
                        <td>
                            <button class="btn-secondary" style="padding: 0.25rem 0.5rem; font-size: 0.75rem;" onclick="openMeetingDetails('${m.id}')">Details</button>
                        </td>
                    </tr>
                `;
                }).join('') : '<tr><td colspan="5" style="text-align: center; padding: 2rem; color: var(--color-slate-400);">No meetings scheduled</td></tr>'}
            </tbody>
        </table>
    `;
    container.innerHTML = html;
}

// ============================================================================
// CALENDAR WIDGET
// ============================================================================

function initializeCalendar() {
    renderCalendar(currentMonth);
}

function renderCalendar(date) {
    const year = date.getFullYear();
    const month = date.getMonth();
    
    // Update header
    const monthNames = ['January', 'February', 'March', 'April', 'May', 'June',
                        'July', 'August', 'September', 'October', 'November', 'December'];
    document.getElementById('calendarMonth').textContent = `${monthNames[month]} ${year}`;
    
    // Get first day of month and number of days
    const firstDay = new Date(year, month, 1).getDay();
    const daysInMonth = new Date(year, month + 1, 0).getDate();
    
    const container = document.getElementById('calendarDays');
    let html = '';
    
    // Add empty cells for days before month starts
    for (let i = 0; i < firstDay; i++) {
        html += '<div class="calendar-day" style="visibility: hidden;"></div>';
    }
    
    // Add days of month
    const today = new Date();
    for (let day = 1; day <= daysInMonth; day++) {
        const currentDate = new Date(year, month, day);
        const dayOfWeek = currentDate.getDay();
        
        // Skip weekends (0 = Sunday, 6 = Saturday)
        if (dayOfWeek === 0 || dayOfWeek === 6) continue;
        
        const isToday = day === today.getDate() && 
                       month === today.getMonth() && 
                       year === today.getFullYear();
        const isPast = currentDate < today && !isToday;
        html += `<div class="calendar-day${isToday ? ' today' : ''}${isPast ? ' past' : ''}">${day}</div>`;
    }
    
    container.innerHTML = html;
}

function previousMonth() {
    currentMonth = new Date(currentMonth.getFullYear(), currentMonth.getMonth() - 1);
    renderCalendar(currentMonth);
}

function nextMonth() {
    currentMonth = new Date(currentMonth.getFullYear(), currentMonth.getMonth() + 1);
    renderCalendar(currentMonth);
}

// ============================================================================
// UI INTERACTIONS
// ============================================================================

function switchPage(pageName) {
    currentPage = pageName;
    
    // Hide all pages
    document.querySelectorAll('.page-content').forEach(page => {
        page.classList.add('hidden');
    });
    
    // Show selected page
    document.getElementById(pageName + 'Page').classList.remove('hidden');
    
    // Update tab active state
    document.querySelectorAll('.page-tab').forEach(tab => {
        tab.classList.remove('active');
    });
    event.target.closest('.page-tab').classList.add('active');
    
    // Load page-specific data if needed
    if (pageName === 'documents') {
        renderDocumentsPage();
    }
}

function toggleAccordion(button) {
    const content = button.nextElementSibling;
    const isOpen = content.classList.contains('open');
    
    if (isOpen) {
        content.classList.remove('open');
        button.classList.remove('open');
    } else {
        content.classList.add('open');
        button.classList.add('open');
    }
}

function toggleSidebar() {
    const sidebar = document.getElementById('sidebar');
    sidebar.classList.toggle('sidebar-hidden');
}

function openMeetingDetails(meetingId) {
    // Close any existing modal first
    closeMeetingModal();
    
    const meeting = dashboardData.meetings.find(m => m.id === meetingId);
    if (!meeting) {
        console.error('Meeting not found:', meetingId);
        return;
    }

    const modalHtml = `
        <div id="meetingModal" class="modal-overlay">
            <div class="modal-container" style="max-width: 600px; width: 90%;">
                <div class="modal-header">
                    <h2 class="modal-title">Edit Meeting</h2>
                    <button class="modal-close-btn" onclick="closeMeetingModal()" type="button">
                        <svg width="24" height="24" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                        </svg>
                    </button>
                </div>
                
                <div class="modal-body">
                    <!-- Meeting Title -->
                    <div class="form-group">
                        <label class="form-label">Meeting Title</label>
                        <input type="text" id="meetingTitle" class="form-input" value="${escapeHtml(meeting.title || '')}" />
                    </div>

                    <!-- Date and Time -->
                    <div class="form-row">
                        <div class="form-group" style="flex: 1;">
                            <label class="form-label">Date</label>
                            <input type="date" id="meetingDate" class="form-input" value="${meeting.date || ''}" />
                        </div>
                        <div class="form-group" style="flex: 1;">
                            <label class="form-label">Time</label>
                            <input type="time" id="meetingTime" class="form-input" value="${meeting.time24 || meeting.time || ''}" />
                        </div>
                    </div>

                    <!-- Description -->
                    <div class="form-group">
                        <label class="form-label">Description</label>
                        <textarea id="meetingDescription" class="form-textarea" rows="3">${escapeHtml(meeting.description || '')}</textarea>
                    </div>

                    <!-- Meeting Type -->
                    <div class="form-group">
                        <label class="form-label">Meeting Type</label>
                        <select id="meetingType" class="form-input">
                            <option value="Operational" ${meeting.meetingType === 'Operational' ? 'selected' : ''}>Operational</option>
                            <option value="Strategic" ${meeting.meetingType === 'Strategic' ? 'selected' : ''}>Strategic</option>
                            <option value="Tactical" ${meeting.meetingType === 'Tactical' ? 'selected' : ''}>Tactical</option>
                            <option value="Review" ${meeting.meetingType === 'Review' ? 'selected' : ''}>Review</option>
                            <option value="Planning" ${meeting.meetingType === 'Planning' ? 'selected' : ''}>Planning</option>
                        </select>
                    </div>

                    <!-- Owner/Organizer -->
                    <div class="form-group">
                        <label class="form-label">Organizer</label>
                        <input type="text" id="meetingOrganizer" class="form-input" value="${escapeHtml(meeting.organizer || '')}" />
                    </div>

                    <!-- Link Prep Session -->
                    <div class="form-group">
                        <label class="form-label">Link Prep Session</label>
                        <select id="prepMeetingSelect" class="form-input">
                            <option value="">-- Select a prep meeting --</option>
                            ${dashboardData.meetings
                                .filter(m => m.id !== meeting.id)
                                .map(m => `<option value="${m.id}" ${meeting.prepMeetingId === m.id ? 'selected' : ''}>${escapeHtml(m.title)} (${m.dateFormatted})</option>`)
                                .join('')}
                        </select>
                        <p class="form-hint">Optional: Link a preparation meeting</p>
                    </div>

                    <!-- Meeting Link/URL -->
                    <div class="form-group">
                        <label class="form-label">Meeting Link (Zoom, Teams, etc.)</label>
                        <input type="url" id="meetingLink" class="form-input" value="${escapeHtml(meeting.link || '')}" placeholder="https://" />
                    </div>

                    <!-- Notes & Commentary -->
                    <div class="form-group">
                        <label class="form-label"> Notes & Commentary</label>
                        <textarea id="meetingNotes" class="form-textarea" rows="4" placeholder="Add meeting notes, agenda items, or commentary...">${escapeHtml(meeting.notes || '')}</textarea>
                    </div>

                    <!-- Linked Documents -->
                    <div class="form-group">
                        <label class="form-label"> Linked Documents</label>
                        <div id="linkedDocsList" class="linked-docs-list">
                            ${meeting.linkedDocuments && meeting.linkedDocuments.length > 0 
                                ? meeting.linkedDocuments.map((doc, idx) => `
                                    <div class="linked-doc-item">
                                        <a href="${doc.url}" target="_blank">${escapeHtml(doc.name)}</a>
                                        <button type="button" onclick="removeLinkedDoc(${idx})" class="remove-doc-btn"></button>
                                    </div>
                                `).join('')
                                : '<p class="no-docs-msg">No documents linked yet.</p>'
                            }
                        </div>
                        <button type="button" onclick="addLinkedDocument()" class="btn-link">+ Add Link</button>
                    </div>
                </div>
                
                <div class="modal-footer">
                    <button type="button" class="btn-secondary" onclick="closeMeetingModal()">Cancel</button>
                    <button type="button" class="btn-danger" onclick="deleteMeeting('${meeting.id}')">Delete</button>
                    <button type="button" class="btn-primary" onclick="saveMeetingChanges('${meeting.id}')">Save Changes</button>
                </div>
            </div>
        </div>
    `;
    
    // Insert modal
    document.body.insertAdjacentHTML('beforeend', modalHtml);
    document.body.style.overflow = 'hidden';
    
    // Add click outside to close
    setTimeout(() => {
        const overlay = document.getElementById('meetingModal');
        if (overlay) {
            overlay.addEventListener('click', function(e) {
                if (e.target === overlay) {
                    closeMeetingModal();
                }
            });
        }
    }, 100);
    
    // Add ESC key to close
    document.addEventListener('keydown', handleModalEscape);
}

function closeMeetingModal() {
    const modal = document.getElementById('meetingModal');
    if (modal) {
        modal.remove();
    }
    document.body.style.overflow = '';
    document.removeEventListener('keydown', handleModalEscape);
}

function saveMeetingPrep(meetingId) {
    const prepId = document.getElementById('prepMeetingSelect').value;
    if (!prepId) {
        closeMeetingModal();
        return;
    }
    
    // In a real app, this would call the backend. For now, we'll simulate it.
    const meeting = dashboardData.meetings.find(m => m.id === meetingId);
    const prepMeeting = dashboardData.meetings.find(m => m.id === prepId);
    
    alert(`Linked "${prepMeeting.title}" as a prep meeting for "${meeting.title}".\n\n(Note: This change will be saved to the spreadsheet in the next update)`);
    closeMeetingModal();
}

function handleModalEscape(e) {
    if (e.key === 'Escape') {
        closeMeetingModal();
    }
}

function saveMeetingChanges(meetingId) {
    const data = {
        id: meetingId,
        title: document.getElementById('meetingTitle').value.trim(),
        date: document.getElementById('meetingDate').value,
        time: document.getElementById('meetingTime').value,
        description: document.getElementById('meetingDescription').value.trim(),
        meetingType: document.getElementById('meetingType').value,
        organizer: document.getElementById('meetingOrganizer').value.trim(),
        prepMeetingId: document.getElementById('prepMeetingSelect').value,
        link: document.getElementById('meetingLink').value.trim(),
        notes: document.getElementById('meetingNotes').value.trim()
    };
    
    if (!data.title) {
        alert('Please enter a meeting title');
        return;
    }
    
    if (!data.date) {
        alert('Please select a date');
        return;
    }
    
    const saveBtn = event.target;
    const originalText = saveBtn.textContent;
    saveBtn.textContent = 'Saving...';
    saveBtn.disabled = true;
    
    google.script.run
        .withSuccessHandler(function(result) {
            if (result.success) {
                alert('Meeting updated successfully!');
                closeMeetingModal();
                loadDashboardData();
            } else {
                alert('Error updating meeting: ' + result.error);
                saveBtn.textContent = originalText;
                saveBtn.disabled = false;
            }
        })
        .withFailureHandler(function(error) {
            alert('Error saving changes: ' + error.message);
            saveBtn.textContent = originalText;
            saveBtn.disabled = false;
        })
        .updateMeeting(data);
}

function deleteMeeting(meetingId) {
    const meeting = dashboardData.meetings.find(m => m.id === meetingId);
    if (!meeting) return;
    
    if (!confirm(`Are you sure you want to delete "${meeting.title}"?\n\nThis action cannot be undone.`)) {
        return;
    }
    
    google.script.run
        .withSuccessHandler(function(result) {
            if (result.success) {
                alert('Meeting deleted successfully!');
                closeMeetingModal();
                loadDashboardData();
            } else {
                alert('Error deleting meeting: ' + result.error);
            }
        })
        .withFailureHandler(function(error) {
            alert('Error deleting meeting: ' + error.message);
        })
        .deleteMeeting(meetingId);
}

function addLinkedDocument() {
    const name = prompt('Enter document name:');
    if (!name) return;
    
    const url = prompt('Enter document URL:');
    if (!url) return;
    
    const docsList = document.getElementById('linkedDocsList');
    const noDocsMsg = docsList.querySelector('.no-docs-msg');
    if (noDocsMsg) noDocsMsg.remove();
    
    const docItem = document.createElement('div');
    docItem.className = 'linked-doc-item';
    docItem.innerHTML = `
        <a href="${escapeHtml(url)}" target="_blank">${escapeHtml(name)}</a>
        <button type="button" onclick="this.parentElement.remove()" class="remove-doc-btn"></button>
    `;
    docsList.appendChild(docItem);
}

function removeLinkedDoc(index) {
    if (confirm('Remove this linked document?')) {
        event.target.closest('.linked-doc-item').remove();
    }
}


function createAgenda() {
    const select = document.getElementById('recurringMeetingSelect');
    const date = document.getElementById('agendaDate');
    
    if (!select.value || !date.value) {
        alert('Please select a meeting and date');
        return;
    }
    
    alert(`Creating agenda for ${select.options[select.selectedIndex].text} on ${date.value}...\n\nThis feature would create a new agenda document.`);
}

// ============================================================================
// UTILITY FUNCTIONS
// ============================================================================

function escapeHtml(text) {
    if (!text) return '';
    const div = document.createElement('div');
    div.textContent = text;
    return div.innerHTML;
}

function showToast(message) {
    const existing = document.getElementById('toastMessage');
    if (existing) existing.remove();
    const toast = document.createElement('div');
    toast.id = 'toastMessage';
    toast.className = 'toast';
    toast.textContent = message;
    document.body.appendChild(toast);
    requestAnimationFrame(() => toast.classList.add('show'));
    setTimeout(() => {
        toast.classList.remove('show');
        setTimeout(() => toast.remove(), 200);
    }, 2500);
}

function formatTime12h(timeStr) {
    return formatTimeStandard(timeStr);
}

// Show recurring meeting select when something is selected
document.addEventListener('DOMContentLoaded', function() {
    const select = document.getElementById('recurringMeetingSelect');
    if (select) {
        select.addEventListener('change', function() {
            const section = document.getElementById('agendaDateSection');
            const dateInput = document.getElementById('agendaDate');
            if (this.value) {
                section.classList.remove('hidden');
                selectedRecurringMeetingId = this.value;
                const selectedOption = this.options[this.selectedIndex];
                selectedRecurringMeetingName = selectedOption.dataset.name || selectedOption.text;
                if (selectedOption.dataset.date) {
                    dateInput.value = selectedOption.dataset.date;
                }
            } else {
                section.classList.add('hidden');
                if (dateInput) dateInput.value = '';
            }
        });
    }
});

// ============================================================================
// AGENDA BUILDER FUNCTIONS
// ============================================================================

/**
 * Render recurring meetings dropdown
 */
function renderRecurringMeetingsDropdown() {
    const select = document.getElementById('recurringMeetingSelect');
    if (!select) return;
    
    const upcomingMeetings = (dashboardData.meetings || []).filter(m => m.date);
    const today = new Date();
    today.setHours(0, 0, 0, 0);

    const sortedMeetings = upcomingMeetings
        .filter(m => {
            const dateObj = new Date((m.date || '') + 'T00:00:00');
            return !isNaN(dateObj) && dateObj >= today;
        })
        .sort((a, b) => {
            const dateCompare = new Date(a.date) - new Date(b.date);
            if (dateCompare !== 0) return dateCompare;
            return timeToMinutes(a.time24 || a.time) - timeToMinutes(b.time24 || b.time);
        });
    
    let html = '<option value="">-- Select Meeting --</option>';
    sortedMeetings.forEach(meeting => {
        const dateObj = new Date((meeting.date || '') + 'T00:00:00');
        const dateLabel = !isNaN(dateObj)
            ? dateObj.toLocaleDateString('en-US', { month: 'short', day: 'numeric' })
            : '';
        const display = dateLabel ? `${dateLabel} | ${meeting.title}` : meeting.title;
        html += `<option value="${escapeHtml(meeting.id)}" data-date="${escapeHtml(meeting.date || '')}" data-name="${escapeHtml(meeting.title || '')}">${escapeHtml(display)}</option>`;
    });
    
    select.innerHTML = html;
}

/**
 * Open the agenda creation modal
 */
function handleCreateAgenda() {
    const meetingSelect = document.getElementById('recurringMeetingSelect');
    const dateInput = document.getElementById('agendaDate');
    
    if (!meetingSelect.value) {
        alert('Please select a recurring meeting');
        return;
    }
    
    if (!dateInput.value) {
        alert('Please select a date for the agenda');
        return;
    }
    
    selectedRecurringMeetingId = meetingSelect.value;
    selectedRecurringMeetingName = meetingSelect.options[meetingSelect.selectedIndex].text;
    selectedAgendaDate = dateInput.value;
    agendaTopics = [''];
    agendaLink = '';
    
    openAgendaModal();
}

/**
 * Open the agenda modal
 */
function openAgendaModal() {
    agendaModalOpen = true;
    
    // Create modal HTML
    const modalHtml = `
        <div id="agendaModal" class="agenda-modal">
            <div class="agenda-modal-overlay" onclick="closeAgendaModal()"></div>
            <div class="agenda-modal-content">
                <div class="agenda-modal-header">
                    <h2>Create Agenda</h2>
                    <button class="agenda-modal-close" onclick="closeAgendaModal()">
                        <svg class="icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                        </svg>
                    </button>
                </div>
                
                <div class="agenda-modal-body">
                    <div class="agenda-info">
                        <div class="agenda-info-item">
                            <strong>Meeting:</strong> ${escapeHtml(selectedRecurringMeetingName)}
                        </div>
                        <div class="agenda-info-item">
                            <strong>Date:</strong> ${formatDate(selectedAgendaDate)}
                        </div>
                    </div>
                    
                    <div class="agenda-section">
                        <h3>Agenda Topics</h3>
                        <div id="agendaTopicsList"></div>
                        <button class="btn-secondary" onclick="addAgendaTopic()">
                            <svg class="icon-xs" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/>
                            </svg>
                            Add Topic
                        </button>
                    </div>
                    
                    <div class="agenda-section">
                        <label class="input-label">Meeting Invite Link</label>
                        <input type="url" 
                               class="input-field" 
                               id="agendaLinkInput" 
                               placeholder="Paste calendar invite or meeting URL..."
                               value="${escapeHtml(agendaLink)}"
                               oninput="agendaLink = this.value">
                        <p class="input-hint">Link to the existing calendar event for easy access</p>
                    </div>
                </div>
                
                <div class="agenda-modal-footer">
                    <button class="btn-secondary" onclick="closeAgendaModal()">Cancel</button>
                    <button class="btn-primary" onclick="handleSaveAgenda()">Save Agenda</button>
                </div>
            </div>
        </div>
    `;
    
    // Add to body
    document.body.insertAdjacentHTML('beforeend', modalHtml);
    
    // Render topics
    renderAgendaTopics();
    
    // Prevent body scroll
    document.body.style.overflow = 'hidden';
}

/**
 * Close the agenda modal
 */
function closeAgendaModal() {
    agendaModalOpen = false;
    const modal = document.getElementById('agendaModal');
    if (modal) {
        modal.remove();
    }
    document.body.style.overflow = '';
}

/**
 * Render agenda topics list
 */
function renderAgendaTopics() {
    const container = document.getElementById('agendaTopicsList');
    if (!container) return;
    
    let html = '';
    agendaTopics.forEach((topic, index) => {
        html += `
            <div class="agenda-topic-item">
                <span class="agenda-topic-number">${index + 1}.</span>
                <input type="text" 
                       class="input-field agenda-topic-input" 
                       placeholder="Enter discussion topic..."
                       value="${escapeHtml(topic)}"
                       oninput="updateAgendaTopic(${index}, this.value)">
                ${agendaTopics.length > 1 ? `
                    <button class="btn-icon-delete" onclick="removeAgendaTopic(${index})" title="Remove topic">
                        <svg class="icon-xs" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/>
                        </svg>
                    </button>
                ` : ''}
            </div>
        `;
    });
    
    container.innerHTML = html;
}

/**
 * Add a new agenda topic
 */
function addAgendaTopic() {
    agendaTopics.push('');
    renderAgendaTopics();
}

/**
 * Update agenda topic at index
 */
function updateAgendaTopic(index, value) {
    agendaTopics[index] = value;
}

/**
 * Remove agenda topic at index
 */
function removeAgendaTopic(index) {
    agendaTopics.splice(index, 1);
    renderAgendaTopics();
}

/**
 * Save the agenda (creates Google Doc)
 */
function handleSaveAgenda() {
    // Filter out empty topics
    const topics = agendaTopics.filter(t => t && t.trim() !== '');
    
    if (topics.length === 0) {
        alert('Please add at least one agenda topic');
        return;
    }
    
    // Show loading state
    const saveBtn = document.querySelector('.agenda-modal-footer .btn-primary');
    const originalText = saveBtn.innerHTML;
    saveBtn.innerHTML = '<span style="opacity: 0.7;">Creating agenda...</span>';
    saveBtn.disabled = true;
    
    // Call backend to create Google Doc
    const agendaSummary = topics.map(t => ` ${t.trim()}`).join('\n');
    
    google.script.run
        .withSuccessHandler(function(result) {
            if (result.success) {
                google.script.run
                    .withSuccessHandler(function(attachResult) {
                        saveBtn.innerHTML = originalText;
                        saveBtn.disabled = false;
                        if (attachResult && attachResult.success) {
                            showToast('Agenda created and attached');
                        } else {
                            showToast('Agenda created');
                        }
                        closeAgendaModal();
                        
                        // Reset form
                        agendaTopics = [''];
                        agendaLink = '';
                        document.getElementById('recurringMeetingSelect').value = '';
                        document.getElementById('agendaDate').value = '';
                        document.getElementById('agendaDateSection').classList.add('hidden');
                        loadDashboardData();
                    })
                    .withFailureHandler(function() {
                        saveBtn.innerHTML = originalText;
                        saveBtn.disabled = false;
                        showToast('Agenda created');
                        closeAgendaModal();
                        loadDashboardData();
                    })
                    .attachAgendaToMeeting({
                        meetingId: selectedRecurringMeetingId,
                        documentUrl: result.documentUrl,
                        documentName: result.documentName,
                        agendaSummary: agendaSummary
                    });
            } else {
                alert('Error creating agenda: ' + result.error);
                saveBtn.innerHTML = originalText;
                saveBtn.disabled = false;
            }
        })
        .withFailureHandler(function(error) {
            alert('Failed to create agenda: ' + error);
            saveBtn.innerHTML = originalText;
            saveBtn.disabled = false;
        })
        .createAgenda({
            meetingName: selectedRecurringMeetingName,
            meetingDate: formatDate(selectedAgendaDate),
            topics: topics,
            meetingLink: agendaLink
        });
}

/**
 * Format date for display
 */
function formatDate(dateStr) {
    const date = new Date(dateStr + 'T00:00:00');
    const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
    return date.toLocaleDateString('en-US', options);
}

/**
 * Get next occurrence of a recurring meeting (helper function)
 */
function getNextDate(frequency) {
    const today = new Date();
    
    if (frequency && frequency.toLowerCase().includes('weekly')) {
        // Next week same day
        const nextWeek = new Date(today);
        nextWeek.setDate(today.getDate() + 7);
        return nextWeek.toISOString().split('T')[0];
    } else if (frequency && frequency.toLowerCase().includes('monthly')) {
        // Next month same date
        const nextMonth = new Date(today);
        nextMonth.setMonth(today.getMonth() + 1);
        return nextMonth.toISOString().split('T')[0];
    }
    
    // Default to tomorrow
    const tomorrow = new Date(today);
    tomorrow.setDate(today.getDate() + 1);
    return tomorrow.toISOString().split('T')[0];
}

// ============================================================================
// MEETINGS VIEW SWITCHING
// ============================================================================

let currentMeetingsView = 'month';
let meetingsCalendarMonth = new Date();

function switchMeetingsView(view) {
    currentMeetingsView = view;
    
    // Update button states
    document.querySelectorAll('.view-btn').forEach(btn => {
        btn.classList.remove('active');
        if (btn.dataset.view === view) {
            btn.classList.add('active');
        }
    });
    
    // Show/hide views
    document.querySelectorAll('.meetings-view').forEach(v => v.classList.add('hidden'));
    const viewEl = document.getElementById(view + 'View');
    if (viewEl) viewEl.classList.remove('hidden');
    
    // Render the appropriate view
    if (view === 'month') {
        renderMeetingsCalendar();
    } else if (view === 'list') {
        renderMeetingsList();
    } else if (view === '90day') {
        render90DayView();
    }
}

function renderMeetingsCalendar() {
    const container = document.getElementById('meetingsCalendarGrid');
    if (!container) return;
    
    const meetings = dashboardData.meetings || [];
    
    const year = meetingsCalendarMonth.getFullYear();
    const month = meetingsCalendarMonth.getMonth();
    const monthNames = ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December'];
    
    const firstDay = new Date(year, month, 1);
    const lastDay = new Date(year, month + 1, 0);
    const totalDays = lastDay.getDate();
    
    const today = new Date();
    const isCurrentMonth = today.getMonth() === month && today.getFullYear() === year;
    
    // Group meetings by date
    const meetingsByDate = {};
    meetings.forEach(m => {
        const dateKey = m.date;
        if (!meetingsByDate[dateKey]) meetingsByDate[dateKey] = [];
        meetingsByDate[dateKey].push(m);
    });
    
    let html = `
        <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 1rem;">
            <button class="calendar-nav-btn" onclick="navigateMeetingsCalendar(-1)">
                <svg class="icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/>
                </svg>
            </button>
            <h3 style="font-size: 1.25rem; font-weight: 700; color: var(--color-slate-800);">${monthNames[month]} ${year}</h3>
            <button class="calendar-nav-btn" onclick="navigateMeetingsCalendar(1)">
                <svg class="icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
                </svg>
            </button>
        </div>
        <div class="calendar-month-grid" style="grid-template-columns: repeat(5, 1fr);">
            <div class="calendar-month-header">Mon</div>
            <div class="calendar-month-header">Tue</div>
            <div class="calendar-month-header">Wed</div>
            <div class="calendar-month-header">Thu</div>
            <div class="calendar-month-header">Fri</div>
    `;
    
    // Find the first Monday of the display (may be in previous month)
    let firstDayOfWeek = firstDay.getDay(); // 0=Sun, 1=Mon, etc.
    
    // Previous month days to fill the first row
    const prevMonth = new Date(year, month, 0);
    const prevMonthDays = prevMonth.getDate();
    
    // We always start the grid on Monday.
    // Calculate how many days from the previous week we need to show to fill the first row.
    // If firstDay is Sunday(0), the previous Monday was 6 days ago.
    // If firstDay is Monday(1), we need 0 days from prev month.
    // If firstDay is Tuesday(2), we need 1 day (Monday).
    let daysToFill = (firstDayOfWeek === 0) ? 6 : firstDayOfWeek - 1;
    const mondayOffset = -daysToFill;
    
    for (let i = daysToFill; i > 0; i--) {
        const d = new Date(year, month, 1);
        d.setDate(d.getDate() - i);
        
        // Only add a cell if it's a weekday (Mon-Fri)
        if (d.getDay() !== 0 && d.getDay() !== 6) {
            html += `<div class="calendar-month-day other-month"><span class="calendar-day-number" style="color: var(--color-slate-300);">${d.getDate()}</span></div>`;
        }
    }
    
    // Current month days
    for (let day = 1; day <= totalDays; day++) {
        const currentDate = new Date(year, month, day);
        const dayOfWeek = currentDate.getDay();
        
        // Skip weekends - they don't get a cell in a 5-column grid
        if (dayOfWeek === 0 || dayOfWeek === 6) {
            continue;
        }
        
        const dateStr = `${year}-${String(month + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
        const isToday = isCurrentMonth && today.getDate() === day;
        const dayMeetings = meetingsByDate[dateStr] || [];
        
        html += `<div class="calendar-month-day${isToday ? ' today' : ''}">
            <span class="calendar-day-number${isToday ? ' today' : ''}">${day}</span>`;
        
        dayMeetings.sort((a, b) => timeToMinutes(a.time24 || a.time) - timeToMinutes(b.time24 || b.time));
        dayMeetings.slice(0, 3).forEach(m => {
            const hotClass = getMeetingColorClass(m);
            html += `<div class="calendar-meeting-item agenda-hoverable ${hotClass}" onclick="openMeetingModal('${m.id}')">
                <div class="calendar-meeting-time">${formatTimeStandard(m.time)}</div>
                <div class="calendar-meeting-title">${escapeHtml(m.title)}</div>
                ${renderAgendaBadge(m)}
            </div>`;
        });
        
        html += `</div>`;
    }
    
    // Calculate how many weekday cells we have so far
    let weekdayCells = 0;
    for (let offset = mondayOffset; offset < 0; offset++) weekdayCells++;
    for (let day = 1; day <= totalDays; day++) {
        const currentDate = new Date(year, month, day);
        const dayOfWeek = currentDate.getDay();
        if (dayOfWeek !== 0 && dayOfWeek !== 6) weekdayCells++;
    }
    
    // Fill remaining cells to complete the grid (5 columns x ~5 rows = ~25 cells)
    const targetCells = Math.ceil(weekdayCells / 5) * 5;
    for (let i = 1; weekdayCells < targetCells; i++) {
        html += `<div class="calendar-month-day other-month"><span class="calendar-day-number" style="color: var(--color-slate-300);">${i}</span></div>`;
        weekdayCells++;
    }
    
    html += `</div>`;
    container.innerHTML = html;
}

function navigateMeetingsCalendar(direction) {
    meetingsCalendarMonth.setMonth(meetingsCalendarMonth.getMonth() + direction);
    renderMeetingsCalendar();
}

function renderMeetingsList() {
    const container = document.getElementById('meetingsListContent');
    if (!container) return;
    
    const meetings = dashboardData.meetings || [];
    
    if (meetings.length === 0) {
        container.innerHTML = '<p style="text-align: center; color: var(--color-slate-500); padding: 2rem;">No meetings scheduled</p>';
        return;
    }
    
    const sorted = [...meetings].sort((a, b) => {
        const dateCompare = new Date(a.date) - new Date(b.date);
        if (dateCompare !== 0) return dateCompare;
        return timeToMinutes(a.time24 || a.time) - timeToMinutes(b.time24 || b.time);
    });
    
    let html = `
        <table class="deliverables-table">
            <thead>
                <tr>
                    <th style="width: 5%;"></th>
                    <th style="width: 15%;">DATE & TIME</th>
                    <th style="width: 30%;">TITLE</th>
                    <th style="width: 15%;">FREQUENCY</th>
                    <th style="width: 15%;">ATTENDEES</th>
                    <th style="width: 10%;">PREP</th>
                    <th style="width: 10%;">DELIVERABLES</th>
                    <th style="width: 5%;">ACTIONS</th>
                </tr>
            </thead>
            <tbody>
    `;
    
    sorted.forEach(m => {
        const colorClass = getMeetingColorClass(m);
        html += `
            <tr onclick="openMeetingModal('${m.id}')" style="cursor: pointer;">
                <td><input type="checkbox" onclick="event.stopPropagation();"></td>
                <td>
                    <div style="font-weight: 600;">${m.dateFormatted || m.date}</div>
                    <div style="font-size: 0.75rem; color: var(--color-slate-500);">${formatTimeStandard(m.time)}</div>
                </td>
                <td>
                    <div class="item-description meeting-title-card agenda-hoverable ${colorClass}">${escapeHtml(m.title)} ${renderAgendaBadge(m)}</div>
                    ${m.isHotTopic ? `<div style="margin-top: 0.25rem;">${renderHotTopicIcon(m)}</div>` : ''}
                    ${m.category ? `<div style="font-size: 0.7rem; color: var(--color-slate-400);">${m.category}</div>` : ''}
                </td>
                <td>${m.frequency || 'One-time'}</td>
                <td style="font-size: 0.75rem;">${escapeHtml(m.attendees || '')}</td>
                <td>
                    ${m.prepRequired ? '<span class="remaining-badge medium">Required</span>' : '<span style="color: var(--color-slate-400);">None</span>'}
                </td>
                <td>${m.deliverables || ''}</td>
                <td>
                    <a href="${m.link || '#'}" target="_blank" class="action-link" onclick="event.stopPropagation();">
                        <svg class="icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"/>
                        </svg>
                    </a>
                </td>
            </tr>
        `;
    });
    
    html += `</tbody></table>`;
    container.innerHTML = html;
}

function render90DayView() {
    const container = document.getElementById('meetings90DayContent');
    if (!container) return;
    
    const meetings = dashboardData.meetings || [];
    const keywordMatches = ['dk', 'sampath', 'vcg elt'];
    
    const isKeyMeeting = (m) => {
        const hot = m.isHotTopic || m.hotTopicLevel === 'urgent' || m.hotTopicLevel === 'must-attend';
        const freq = (m.frequency || '').toLowerCase();
        const isRecurring = freq.includes('weekly') || freq.includes('monthly') || freq.includes('daily') || freq.includes('bi-weekly') || freq.includes('biweekly');
        const title = (m.title || '').toLowerCase();
        const attendees = (m.attendees || '').toLowerCase();
        const hasKeyword = keywordMatches.some(k => title.includes(k) || attendees.includes(k));
        return hot || !isRecurring || hasKeyword;
    };
    
    const today = new Date();
    const monthNames = ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December'];
    
    const months = [];
    for (let i = 0; i < 3; i++) {
        const d = new Date(today.getFullYear(), today.getMonth() + i, 1);
        months.push({
            year: d.getFullYear(),
            month: d.getMonth(),
            name: monthNames[d.getMonth()] + ' ' + d.getFullYear()
        });
    }
    
    const meetingsByMonth = {};
    meetings.forEach(m => {
        const d = new Date(m.date);
        const key = `${d.getFullYear()}-${d.getMonth()}`;
        if (!meetingsByMonth[key]) meetingsByMonth[key] = [];
        meetingsByMonth[key].push(m);
    });
    
    let html = '<div class="ninety-day-container">';
    
    months.forEach(mo => {
        const key = `${mo.year}-${mo.month}`;
        const monthMeetings = (meetingsByMonth[key] || []).filter(isKeyMeeting).sort((a, b) => {
            const dateCompare = new Date(a.date) - new Date(b.date);
            if (dateCompare !== 0) return dateCompare;
            return timeToMinutes(a.time24 || a.time) - timeToMinutes(b.time24 || b.time);
        });
        
        html += `
            <div class="month-card">
                <div class="month-ribbon">${mo.name}</div>
                <div class="month-card-body">
                    <ul class="month-events">
        `;
        
        if (monthMeetings.length === 0) {
            html += '<li class="month-empty">No meetings scheduled</li>';
        } else {
            // Sort meetings by date, then by time
            monthMeetings.sort((a, b) => {
                const dateCompare = new Date(a.date) - new Date(b.date);
                if (dateCompare !== 0) return dateCompare;
                return timeToMinutes(a.time24 || a.time) - timeToMinutes(b.time24 || b.time);
            }).forEach(m => {
                const d = new Date(m.date + 'T00:00:00'); // Use ISO string to avoid timezone issues
                const hotClass = getMeetingColorClass(m);
                const itemClasses = [
                    'month-event-compact',
                    hotClass,
                    m.prepRequired ? 'prep' : ''
                ].filter(Boolean).join(' ');
                
                const attendees = m.attendees ? escapeHtml(m.attendees) : '';
                const detailParts = [
                    formatTimeStandard(m.time) || 'TBD',
                    m.category ? escapeHtml(m.category) : '',
                    attendees ? `Attendees: ${attendees}` : ''
                ].filter(Boolean).join('  ');
                
                html += `
                        <li class="agenda-hoverable ${itemClasses}" onclick="this.classList.toggle('expanded')">
                            <span class="month-event-date">${d.getDate()}</span>
                            <span class="month-event-pipe">|</span>
                            <div>
                                <div class="month-event-title">${escapeHtml(m.title)} ${renderAgendaBadge(m)}</div>
                                ${detailParts ? `<div class="month-event-details">${detailParts}</div>` : ''}
                            </div>
                        </li>
                `;
            });
        }
        
        html += `
                    </ul>
                </div>
            </div>
        `;
    });
    
    html += '</div>';
    container.innerHTML = html;
}

// ============================================================================
// MEETING MODAL
// ============================================================================

let currentMeetingId = null;

function openMeetingModal(meetingId) {
    currentMeetingId = meetingId;
    const meeting = dashboardData.meetings.find(m => m.id === meetingId);
    
    if (!meeting) {
        console.error('Meeting not found:', meetingId);
        return;
    }
    
    const otherMeetings = dashboardData.meetings.filter(m => m.id !== meetingId);
    
    const modalHtml = `
        <div class="meeting-modal" id="meetingModalNew">
            <div class="meeting-modal-overlay" onclick="closeMeetingModalNew()"></div>
            <div class="meeting-modal-content">
                <div class="meeting-modal-header">
                    <div>
                        <div class="meeting-modal-title">${escapeHtml(meeting.title)}</div>
                        <div class="meeting-modal-subtitle">
                             ${meeting.dateFormatted || meeting.date} |  ${formatTimeStandard(meeting.time)}
                        </div>
                    </div>
                    <button class="meeting-modal-close" onclick="closeMeetingModalNew()">
                        <svg class="icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                        </svg>
                    </button>
                </div>
                <div class="meeting-modal-body">
                    <div class="form-group">
                        <label class="form-label"> Notes & Commentary</label>
                        <textarea class="form-textarea" id="meetingNotesNew" placeholder="Add meeting notes, agenda items, or commentary...">${escapeHtml(meeting.notes || '')}</textarea>
                    </div>

                    <div class="form-group">
                        <label class="form-label"> Agenda Topics</label>
                        <textarea class="form-textarea" id="meetingAgendaTopicsNew" placeholder="Add or edit agenda topics...">${escapeHtml((meeting.notes || '').includes('Agenda Topics:') ? (meeting.notes || '').split('Agenda Topics:')[1].trim() : '')}</textarea>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Link Prep Session</label>
                        <select class="form-select" id="prepMeetingSelectNew">
                            <option value="">-- Select a prep meeting --</option>
                            ${otherMeetings.map(m => `<option value="${m.id}"${meeting.prepMeetingId === m.id ? ' selected' : ''}>${m.title} (${m.dateFormatted || m.date})</option>`).join('')}
                        </select>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Due Date for Deliverables</label>
                            <input type="date" class="form-input" id="deliverableDueDateNew" value="${meeting.deliverableDueDate || ''}">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Meeting Type</label>
                            <select class="form-select" id="meetingTypeNew">
                                <option value="Operational"${meeting.category === 'Operational' ? ' selected' : ''}>Operational</option>
                                <option value="Strategic"${meeting.category === 'Strategic' ? ' selected' : ''}>Strategic</option>
                                <option value="Governance"${meeting.category === 'Governance' ? ' selected' : ''}>Governance</option>
                                <option value="Review"${meeting.category === 'Review' ? ' selected' : ''}>Review</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Owner View</label>
                            <input type="text" class="form-input" id="ownerViewNew" value="${escapeHtml(meeting.owner || 'Exec1')}" placeholder="e.g., Exec1">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Meeting Type</label>
                            <input type="text" class="form-input" id="meetingTypeTextNew" value="${escapeHtml(meeting.meetingType || 'Operational')}" placeholder="e.g., Operational">
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label"> Hyperlink</label>
                        <input type="url" class="form-input" id="meetingLinkNew" value="${escapeHtml(meeting.link || '')}" placeholder="https://example.com/meeting-materials">
                    </div>

                    <div class="form-group">
                        <label class="form-label"> Agenda Link</label>
                        <input type="url" class="form-input" id="meetingAgendaLinkNew" value="${escapeHtml(meeting.deliverableLink || '')}" placeholder="https://example.com/agenda-doc">
                    </div>
                    
                    <div class="linked-docs-section">
                        <div class="linked-docs-header">
                            <span class="linked-docs-title"> Linked Documents</span>
                            <button class="add-link-btn" onclick="addLinkedDocumentNew()">+ Add Link</button>
                        </div>
                        <div id="linkedDocsListNew">
                            <p style="font-size: 0.75rem; color: var(--color-slate-400);">No documents linked yet.</p>
                        </div>
                    </div>
                </div>
                <div class="meeting-modal-footer">
                    <button class="btn-secondary" onclick="closeMeetingModalNew()">Close</button>
                    <button class="btn-primary" onclick="saveMeetingChangesNew()">Save Changes</button>
                </div>
            </div>
        </div>
    `;
    
    const existingModal = document.getElementById('meetingModalNew');
    if (existingModal) existingModal.remove();
    
    document.body.insertAdjacentHTML('beforeend', modalHtml);
}

function closeMeetingModalNew() {
    const modal = document.getElementById('meetingModalNew');
    if (modal) modal.remove();
    currentMeetingId = null;
}

function saveMeetingChangesNew() {
    if (!currentMeetingId) return;
    
    const notes = document.getElementById('meetingNotesNew').value;
    const agendaTopics = document.getElementById('meetingAgendaTopicsNew').value;
    const prepMeetingId = document.getElementById('prepMeetingSelectNew').value;
    const deliverableDueDate = document.getElementById('deliverableDueDateNew').value;
    const meetingType = document.getElementById('meetingTypeNew').value;
    const ownerView = document.getElementById('ownerViewNew').value;
    const link = document.getElementById('meetingLinkNew').value;
    const agendaLink = document.getElementById('meetingAgendaLinkNew').value;
    
    console.log('Saving meeting changes:', {
        meetingId: currentMeetingId,
        notes,
        agendaTopics,
        prepMeetingId,
        deliverableDueDate,
        meetingType,
        ownerView,
        link,
        agendaLink
    });
    
    if (typeof google !== 'undefined' && google.script) {
        google.script.run
            .withSuccessHandler(() => {
                closeMeetingModalNew();
                loadDashboardData();
            })
            .withFailureHandler(err => {
                console.error('Failed to save:', err);
                alert('Failed to save changes. Please try again.');
            })
            .updateMeeting(currentMeetingId, {
                notes,
                agendaTopics,
                prepMeetingId,
                deliverableDueDate,
                category: meetingType,
                owner: ownerView,
                link,
                deliverableLink: agendaLink
            });
    } else {
        alert('Changes saved (preview mode)');
        closeMeetingModalNew();
    }
}

function addLinkedDocumentNew() {
    const url = prompt('Enter document URL:');
    if (url) {
        const name = prompt('Enter document name:') || 'Document';
        const container = document.getElementById('linkedDocsListNew');
        container.innerHTML = `
            <div style="display: flex; align-items: center; gap: 0.5rem; padding: 0.5rem; background-color: white; border-radius: 0.25rem; margin-bottom: 0.25rem;">
                 <a href="${url}" target="_blank">${escapeHtml(name)}</a>
            </div>
        `;
    }
}

function openNewMeetingModal() {
    alert('New meeting creation - coming soon!');
}

function exportMeetingsReport() {
    alert('Export report - coming soon!');
}

// Update switchPage to initialize meetings view
const originalSwitchPage = switchPage;
function switchPage(pageName) {
    currentPage = pageName;
    
    document.querySelectorAll('.page-content').forEach(page => {
        page.classList.add('hidden');
    });
    
    document.getElementById(pageName + 'Page').classList.remove('hidden');
    
    document.querySelectorAll('.page-tab').forEach(tab => {
        tab.classList.remove('active');
    });
    if (event && event.target) {
        const tabBtn = event.target.closest('.page-tab');
        if (tabBtn) tabBtn.classList.add('active');
    }
    
    if (pageName === 'meetings') {
        switchMeetingsView(currentMeetingsView);
    } else if (pageName === 'documents') {
        renderDocumentsPage();
    }
}


// ============================================================================
// DELIVERABLE MODAL FUNCTIONALITY
// ============================================================================

function openDeliverableModal(id, description, eta, owner, link, comments) {
    let modal = document.getElementById('deliverableModal');
    if (!modal) {
        createDeliverableModal();
        modal = document.getElementById('deliverableModal');
    }
    
    // Populate modal with EDITABLE data
    document.getElementById('modalDescription').value = description || '';
    document.getElementById('modalETA').value = eta || '';
    document.getElementById('modalOwner').value = owner || '';
    document.getElementById('modalLink').value = link || '';
    document.getElementById('modalComments').value = comments || '';

    const agendaContainer = document.getElementById('deliverableAgendaTopics');
    if (agendaContainer) {
        const agendaTopics = findAgendaTopicsForDeliverable(description || '');
        agendaContainer.textContent = agendaTopics || 'No agenda topics linked.';
    }
    
    // Store ID for saving
    modal.dataset.itemId = id;
    modal.dataset.itemType = 'deliverable';
    
    // Show modal
    modal.style.display = 'flex';
}

function findAgendaTopicsForDeliverable(description) {
    if (!description) return '';
    const match = (dashboardData.meetings || []).find(m => {
        return (m.title || '').toLowerCase().trim() === String(description).toLowerCase().trim();
    });
    if (!match || !match.notes) return '';
    const parts = String(match.notes).split('Agenda Topics:');
    if (parts.length < 2) return '';
    return parts[1].trim();
}

function createDeliverableModal() {
    const modalHTML = `
        <div id="deliverableModal" class="modal-overlay" style="display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.5); z-index: 1000; align-items: center; justify-content: center;" onclick="closeDeliverableModal(event)">
            <div class="modal-content" style="background: white; border-radius: 1rem; max-width: 700px; width: 90%; max-height: 90vh; overflow-y: auto; box-shadow: 0 20px 25px -5px rgba(0,0,0,0.1);" onclick="event.stopPropagation()">
                <div class="modal-header" style="padding: 1.5rem; border-bottom: 1px solid var(--color-slate-200); display: flex; align-items: center; justify-content: space-between;">
                    <div>
                        <h3 style="font-size: 1.25rem; font-weight: 700; display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.25rem;">
                            <span> Deliverable Details</span>
                        </h3>
                    </div>
                    <button onclick="closeDeliverableModal()" style="background: none; border: none; cursor: pointer; padding: 0.5rem; color: var(--color-slate-500);">
                        <svg style="width: 24px; height: 24px;" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                        </svg>
                    </button>
                </div>
                <div class="modal-body" style="padding: 1.5rem;">
                    <!-- Description -->
                    <div style="margin-bottom: 1.5rem;">
                        <label style="display: block; font-weight: 600; color: var(--color-slate-700); margin-bottom: 0.5rem;"> Description</label>
                        <textarea id="modalDescription" style="width: 100%; min-height: 80px; padding: 0.75rem; border: 1px solid var(--color-slate-300); border-radius: 0.5rem; font-size: 0.875rem; resize: vertical;" placeholder="Enter deliverable description..."></textarea>
                    </div>
                    
                    <!-- ETA and Owner Row -->
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin-bottom: 1.5rem;">
                        <div>
                            <label style="display: block; font-weight: 600; color: var(--color-slate-700); margin-bottom: 0.5rem;"> ETA</label>
                            <input type="text" id="modalETA" style="width: 100%; padding: 0.75rem; border: 1px solid var(--color-slate-300); border-radius: 0.5rem; font-size: 0.875rem;" placeholder="e.g., 2026-01-30">
                        </div>
                        <div>
                            <label style="display: block; font-weight: 600; color: var(--color-slate-700); margin-bottom: 0.5rem;"> Owner</label>
                            <input type="text" id="modalOwner" style="width: 100%; padding: 0.75rem; border: 1px solid var(--color-slate-300); border-radius: 0.5rem; font-size: 0.875rem;" placeholder="e.g., John Doe">
                        </div>
                    </div>

                    <!-- Agenda Topics -->
                    <div style="margin-bottom: 1.5rem;">
                        <label style="display: block; font-weight: 600; color: var(--color-slate-700); margin-bottom: 0.5rem;"> Agenda Topics</label>
                        <div id="deliverableAgendaTopics" style="width: 100%; min-height: 80px; padding: 0.75rem; border: 1px solid var(--color-slate-300); border-radius: 0.5rem; font-size: 0.875rem; white-space: pre-line; background: var(--color-slate-50);"></div>
                    </div>
                    
                    <!-- Hyperlink -->
                    <div style="margin-bottom: 1.5rem;">
                        <label style="display: block; font-weight: 600; color: var(--color-slate-700); margin-bottom: 0.5rem;"> Hyperlink</label>
                        <input type="url" id="modalLink" style="width: 100%; padding: 0.75rem; border: 1px solid var(--color-slate-300); border-radius: 0.5rem; font-size: 0.875rem;" placeholder="https://example.com/document">
                    </div>
                    
                    <!-- Comments -->
                    <div style="margin-bottom: 1.5rem;">
                        <label style="display: block; font-weight: 600; color: var(--color-slate-700); margin-bottom: 0.5rem;"> Comments</label>
                        <textarea id="modalComments" style="width: 100%; min-height: 80px; padding: 0.75rem; border: 1px solid var(--color-slate-300); border-radius: 0.5rem; font-size: 0.875rem; resize: vertical;" placeholder="Add comments or notes..."></textarea>
                    </div>
                    
                </div>
                <div class="modal-footer" style="padding: 1.5rem; border-top: 1px solid var(--color-slate-200); background: var(--color-slate-50); display: flex; gap: 1rem; justify-content: space-between;">
                    <button onclick="deleteDeliverable()" style="padding: 0.75rem 1.5rem; border: 1px solid var(--color-red-300); background: white; color: var(--color-red-700); border-radius: 0.5rem; cursor: pointer; font-weight: 600; font-size: 0.875rem;">
                        Delete
                    </button>
                    <div style="display: flex; gap: 1rem;">
                        <button onclick="closeDeliverableModal()" style="padding: 0.75rem 1.5rem; border: 1px solid var(--color-slate-300); background: white; border-radius: 0.5rem; cursor: pointer; font-weight: 600; font-size: 0.875rem;">
                            Close
                        </button>
                        <button onclick="saveDeliverableChanges()" style="padding: 0.75rem 1.5rem; border: none; background: var(--color-red-700); color: white; border-radius: 0.5rem; cursor: pointer; font-weight: 600; font-size: 0.875rem;">
                            Save Changes
                        </button>
                    </div>
                </div>
            </div>
        </div>
    `;
    document.body.insertAdjacentHTML('beforeend', modalHTML);
}



function addLinkedDocument() {
    const url = prompt('Enter document URL:');
    if (!url) return;
    
    const linkedDocsDiv = document.getElementById('modalLinkedDocs');
    const isEmpty = linkedDocsDiv.querySelector('p');
    if (isEmpty) linkedDocsDiv.innerHTML = '';
    
    const docHtml = `
        <div style="display: flex; align-items: center; gap: 0.5rem; padding: 0.5rem; background: white; border-radius: 0.375rem; border: 1px solid var(--color-slate-200); margin-bottom: 0.5rem;">
            <svg style="width: 16px; height: 16px; color: var(--color-slate-400);" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
            </svg>
            <a href="${url}" target="_blank" style="flex: 1; color: var(--color-red-600); text-decoration: none; font-size: 0.875rem;">${url}</a>
            <button onclick="this.parentElement.remove()" style="background: none; border: none; cursor: pointer; padding: 0.25rem;">
                <svg style="width: 16px; height: 16px; color: var(--color-slate-400);" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                </svg>
            </button>
        </div>
    `;
    linkedDocsDiv.insertAdjacentHTML('beforeend', docHtml);
}

function saveDeliverableChanges() {
    const modal = document.getElementById('deliverableModal');
    const itemId = modal.dataset.itemId;
    const idParts = itemId ? itemId.split('-') : [];
    const execType = idParts.length === 2 ? idParts[0] : '';
    const itemIndex = idParts.length === 2 ? parseInt(idParts[1], 10) : null;
    
    const data = {
        id: itemId,
        execType: execType,
        itemIndex: itemIndex,
        description: document.getElementById('modalDescription').value,
        eta: document.getElementById('modalETA').value,
        owner: document.getElementById('modalOwner').value,
        link: document.getElementById('modalLink').value,
        comments: document.getElementById('modalComments').value
    };
    
    console.log('Saving deliverable changes:', data);
    
    if (typeof google !== 'undefined' && google.script) {
        google.script.run
            .withSuccessHandler((result) => {
                if (result && result.success) {
                    showToast('Changes saved successfully');
                    closeDeliverableModal();
                    loadDashboardData();
                } else {
                    alert('Error saving changes: ' + (result && result.error ? result.error : 'Unknown error'));
                }
            })
            .withFailureHandler((error) => {
                alert('Error saving changes: ' + error);
            })
            .updateDeliverable(data);
    } else {
        showToast('Changes saved successfully');
        closeDeliverableModal();
    }
}


function closeDeliverableModal(event) {
    if (!event || event.target === event.currentTarget) {
        const modal = document.getElementById('deliverableModal');
        if (modal) modal.style.display = 'none';
    }
}

function deleteDeliverable() {
    if (!confirm('Are you sure you want to delete this deliverable?')) {
        return;
    }
    
    const modal = document.getElementById('deliverableModal');
    const itemId = modal.dataset.itemId;
    
    if (typeof google !== 'undefined' && google.script) {
        google.script.run
            .withSuccessHandler(() => {
                alert('Deliverable deleted successfully!');
                closeDeliverableModal();
                loadDashboardData();
            })
            .withFailureHandler((error) => {
                alert('Error deleting deliverable: ' + error);
            })
            .deleteDeliverable(itemId);
    } else {
        alert('Deliverable deleted successfully! (Demo mode)');
        closeDeliverableModal();
    }
}

function showCompletionOptions() {
    const modal = document.getElementById('deliverableModal');
    const itemId = modal.dataset.itemId;
    
    const choice = confirm('Where would you like to move this completed item?\n\nOK = Document Repository\nCancel = Executive Updates');
    
    const destination = choice ? 'Document Repository' : 'Executive Updates';
    
    // Call backend to mark complete and move item
    google.script.run
        .withSuccessHandler(() => {
            alert(`Item marked complete and moved to ${destination}`);
            closeDeliverableModal();
            loadDashboardData(); // Refresh data
        })
        .withFailureHandler((error) => {
            alert('Error completing item: ' + error);
        })
        .completeItem(itemId, destination);
}

// ============================================================================
// ADD NEW ITEM FUNCTIONALITY
// ============================================================================

function openAddItemModal(section) {
    const modal = document.getElementById('addItemModal');
    if (!modal) {
        createAddItemModal();
    }
    
    document.getElementById('addItemSection').value = section;
    document.getElementById('addItemForm').reset();
    modal.style.display = 'flex';
}

function createAddItemModal() {
    const modalHTML = `
        <div id="addItemModal" class="modal-overlay" style="display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.5); z-index: 1000; align-items: center; justify-content: center;" onclick="closeAddItemModal(event)">
            <div class="modal-content" style="background: white; border-radius: 1rem; max-width: 600px; width: 90%; max-height: 90vh; overflow-y: auto; box-shadow: 0 20px 25px -5px rgba(0,0,0,0.1);" onclick="event.stopPropagation()">
                <div class="modal-header" style="padding: 1.5rem; border-bottom: 1px solid var(--color-slate-200); display: flex; align-items: center; justify-content: space-between;">
                    <h3 style="font-size: 1.25rem; font-weight: 700;">Add New Item</h3>
                    <button onclick="closeAddItemModal()" style="background: none; border: none; cursor: pointer; padding: 0.5rem; color: var(--color-slate-500);">
                        <svg style="width: 24px; height: 24px;" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                        </svg>
                    </button>
                </div>
                <form id="addItemForm" onsubmit="submitNewItem(event)" style="padding: 1.5rem;">
                    <input type="hidden" id="addItemSection" value="">
                    
                    <div style="margin-bottom: 1rem;">
                        <label style="display: block; font-weight: 600; color: var(--color-slate-700); margin-bottom: 0.5rem;">Description *</label>
                        <input type="text" id="addItemDescription" required style="width: 100%; padding: 0.5rem; border: 1px solid var(--color-slate-300); border-radius: 0.375rem;">
                    </div>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin-bottom: 1rem;">
                        <div>
                            <label style="display: block; font-weight: 600; color: var(--color-slate-700); margin-bottom: 0.5rem;">ETA</label>
                            <input type="date" id="addItemETA" style="width: 100%; padding: 0.5rem; border: 1px solid var(--color-slate-300); border-radius: 0.375rem;">
                        </div>
                        <div>
                            <label style="display: block; font-weight: 600; color: var(--color-slate-700); margin-bottom: 0.5rem;">Owner</label>
                            <input type="text" id="addItemOwner" style="width: 100%; padding: 0.5rem; border: 1px solid var(--color-slate-300); border-radius: 0.375rem;">
                        </div>
                    </div>
                    
                    <div style="margin-bottom: 1rem;">
                        <label style="display: block; font-weight: 600; color: var(--color-slate-700); margin-bottom: 0.5rem;">Link (URL)</label>
                        <input type="url" id="addItemLink" style="width: 100%; padding: 0.5rem; border: 1px solid var(--color-slate-300); border-radius: 0.375rem;">
                    </div>
                    
                    <div style="margin-bottom: 1rem;">
                        <label style="display: block; font-weight: 600; color: var(--color-slate-700); margin-bottom: 0.5rem;">Comments</label>
                        <textarea id="addItemComments" rows="3" style="width: 100%; padding: 0.5rem; border: 1px solid var(--color-slate-300); border-radius: 0.375rem;"></textarea>
                    </div>
                    
                    
                    <div style="display: flex; gap: 1rem; justify-content: flex-end; padding-top: 1rem; border-top: 1px solid var(--color-slate-200);">
                        <button type="button" onclick="closeAddItemModal()" style="padding: 0.5rem 1rem; border: 1px solid var(--color-slate-300); background: white; border-radius: 0.375rem; cursor: pointer; font-weight: 500;">
                            Cancel
                        </button>
                        <button type="submit" style="padding: 0.5rem 1rem; border: none; background: var(--color-red-600); color: white; border-radius: 0.375rem; cursor: pointer; font-weight: 500;">
                            Add Item
                        </button>
                    </div>
                </form>
            </div>
        </div>
    `;
    document.body.insertAdjacentHTML('beforeend', modalHTML);
}

function closeAddItemModal(event) {
    if (!event || event.target === event.currentTarget) {
        const modal = document.getElementById('addItemModal');
        if (modal) modal.style.display = 'none';
    }
}

function submitNewItem(event) {
    event.preventDefault();
    
    const itemData = {
        section: document.getElementById('addItemSection').value,
        description: document.getElementById('addItemDescription').value,
        eta: document.getElementById('addItemETA').value,
        owner: document.getElementById('addItemOwner').value,
        link: document.getElementById('addItemLink').value,
        comments: document.getElementById('addItemComments').value
    };
    
    // Call backend to add item
    google.script.run
        .withSuccessHandler(() => {
            showToast('Item added successfully');
            closeAddItemModal();
            loadDashboardData(); // Refresh data
        })
        .withFailureHandler((error) => {
            alert('Error adding item: ' + error);
        })
        .addNewItem(itemData);
}

// ============================================================================
// PDF EXPORT FUNCTIONALITY
// ============================================================================

function openPDFExportModal() {
    const modal = document.getElementById('pdfExportModal');
    modal.classList.remove('hidden');
    
    // Populate meetings list
    const meetingsList = document.getElementById('pdfMeetingsList');
    const selectAllToggle = document.getElementById('pdfSelectAll');
    const dayFilters = document.getElementById('pdfDayFilters');
    const { allDates: twoWeekDates } = getTwoWeekScheduleDates();
    const twoWeekDateSet = new Set(twoWeekDates);
    const meetingsInView = (dashboardData.meetings || []).filter(m => m.date && twoWeekDateSet.has(m.date));
    
    if (!meetingsInView || meetingsInView.length === 0) {
        meetingsList.innerHTML = '<p style="color: var(--color-slate-500); text-align: center; padding: 1rem;">No meetings available</p>';
        if (dayFilters) {
            dayFilters.innerHTML = '<span style="color: var(--color-slate-400); font-size: 0.75rem;">No days with meetings in the 2-week view.</span>';
        }
        if (selectAllToggle) {
            selectAllToggle.checked = false;
            selectAllToggle.indeterminate = false;
            selectAllToggle.disabled = true;
        }
        return;
    }
    
    if (selectAllToggle) {
        selectAllToggle.disabled = false;
    }
    
    // Detect conflicts
    const meetingsByDate = {};
    meetingsInView.forEach(m => {
        if (!meetingsByDate[m.date]) {
            meetingsByDate[m.date] = [];
        }
        meetingsByDate[m.date].push(m);
    });
    
    // Mark conflicts
    for (const date in meetingsByDate) {
        const timeSlots = {};
        meetingsByDate[date].forEach(m => {
            const timeKey = m.time24 || m.time || '00:00';
            if (!timeSlots[timeKey]) {
                timeSlots[timeKey] = [];
            }
            timeSlots[timeKey].push(m);
        });
        
        for (const timeKey in timeSlots) {
            if (timeSlots[timeKey].length > 1) {
                timeSlots[timeKey].forEach(m => {
                    m.hasConflict = true;
                });
            }
        }
    }
    
    // Render meetings list
    const sortedMeetings = [...meetingsInView].sort((a, b) => {
        const dateCompare = new Date(a.date) - new Date(b.date);
        if (dateCompare !== 0) return dateCompare;
        return timeToMinutes(a.time24 || a.time) - timeToMinutes(b.time24 || b.time);
    });
    meetingsList.innerHTML = sortedMeetings.map(m => `
        <label style="display: flex; align-items: center; gap: 0.75rem; padding: 0.75rem; border-bottom: 1px solid var(--color-slate-100); cursor: pointer;">
            <input type="checkbox" class="pdf-meeting-checkbox" value="${m.id}" data-date="${escapeHtml(m.date || '')}" checked>
            <div style="flex: 1;">
                <div style="font-weight: 600; font-size: 0.875rem;">
                    ${escapeHtml(m.title)}
                    ${m.hasConflict ? '<span style="color: var(--color-red-600); margin-left: 0.5rem;"> CONFLICT</span>' : ''}
                </div>
                <div style="font-size: 0.75rem; color: var(--color-slate-500);">
                    ${m.dateFormatted || ''} at ${formatTimeStandard(m.time) || 'TBD'}
                    ${m.prepRequired ? '   Prep Required' : ''}
                </div>
            </div>
        </label>
    `).join('');

    const meetingCheckboxes = Array.from(document.querySelectorAll('.pdf-meeting-checkbox'));
    const dayCheckboxes = [];
    if (dayFilters) {
        dayFilters.innerHTML = twoWeekDates.map(dateStr => {
            const count = (meetingsByDate[dateStr] || []).length;
            const d = new Date(dateStr + 'T00:00:00');
            const label = d.toLocaleDateString('en-US', { weekday: 'short', month: 'short', day: 'numeric' });
            const disabled = count === 0 ? 'disabled' : '';
            return `
                <label style="display: inline-flex; align-items: center; gap: 0.4rem; padding: 0.25rem 0.5rem; border: 1px solid var(--color-slate-200); border-radius: 999px; font-size: 0.75rem; cursor: ${count === 0 ? 'not-allowed' : 'pointer'}; color: ${count === 0 ? 'var(--color-slate-400)' : 'var(--color-slate-700)'};">
                    <input type="checkbox" class="pdf-day-checkbox" value="${escapeHtml(dateStr)}" ${disabled} style="margin: 0;">
                    <span>${label} (${count})</span>
                </label>
            `;
        }).join('');
        dayCheckboxes.push(...Array.from(dayFilters.querySelectorAll('.pdf-day-checkbox')));
    }

    const updateSelectAllState = () => {
        if (!selectAllToggle) return;
        const checkedCount = meetingCheckboxes.filter(cb => cb.checked).length;
        selectAllToggle.checked = checkedCount === meetingCheckboxes.length;
        selectAllToggle.indeterminate = checkedCount > 0 && checkedCount < meetingCheckboxes.length;
    };

    const updateDayFilterState = () => {
        if (!dayCheckboxes.length) return;
        dayCheckboxes.forEach(dayCb => {
            const dateStr = dayCb.value;
            const dayMeetings = meetingCheckboxes.filter(cb => cb.dataset.date === dateStr);
            if (dayMeetings.length === 0) {
                dayCb.checked = false;
                dayCb.indeterminate = false;
                return;
            }
            const checkedCount = dayMeetings.filter(cb => cb.checked).length;
            dayCb.checked = checkedCount === dayMeetings.length;
            dayCb.indeterminate = checkedCount > 0 && checkedCount < dayMeetings.length;
        });
    };
    
    if (selectAllToggle) {
        selectAllToggle.onchange = () => {
            meetingCheckboxes.forEach(cb => {
                cb.checked = selectAllToggle.checked;
            });
            updateSelectAllState();
            updateDayFilterState();
        };
    }

    dayCheckboxes.forEach(dayCb => {
        dayCb.onchange = () => {
            const dateStr = dayCb.value;
            meetingCheckboxes
                .filter(cb => cb.dataset.date === dateStr)
                .forEach(cb => {
                    cb.checked = dayCb.checked;
                });
            updateSelectAllState();
            updateDayFilterState();
        };
    });
    
    meetingCheckboxes.forEach(cb => {
        cb.onchange = () => {
            updateSelectAllState();
            updateDayFilterState();
        };
    });
    
    updateSelectAllState();
    updateDayFilterState();
}

function closePDFExportModal() {
    const modal = document.getElementById('pdfExportModal');
    modal.classList.add('hidden');
}

function generatePDFExport(btn, previewMode = false) {
    const title = document.getElementById('pdfWeekTitle').value || 'Two-Week Executive Schedule';
    const includePrepMeetings = document.getElementById('pdfPrepMeetings').checked;
    const notes = document.getElementById('pdfNotes').value.trim();
    const selectedMeetings = Array.from(document.querySelectorAll('.pdf-meeting-checkbox:checked')).map(cb => cb.value);
    
    if (selectedMeetings.length === 0) {
        alert('Please select at least one meeting to export');
        return;
    }
    
    const exportBtn = btn || document.querySelector('#pdfExportModal .btn-primary');
    const originalText = exportBtn.innerHTML;
    exportBtn.disabled = true;
    exportBtn.innerHTML = previewMode ? 'Preparing Preview...' : 'Generating...';
    
    const canUseBackend = typeof google !== 'undefined' &&
        google.script &&
        google.script.run &&
        typeof google.script.run.generateWeeklySchedulePDF === 'function';
    
    if (canUseBackend) {
        google.script.run
            .withSuccessHandler((result) => {
                exportBtn.disabled = false;
                exportBtn.innerHTML = originalText;
                
                if (result && result.success) {
                    window.open(result.downloadUrl, '_blank');
                    closePDFExportModal();
                } else {
                    alert('Error generating PDF: ' + (result.error || 'Unknown error'));
                }
            })
            .withFailureHandler((error) => {
                exportBtn.disabled = false;
                exportBtn.innerHTML = originalText;
                alert('Error: ' + error);
            })
            .generateWeeklySchedulePDF({
                weekTitle: title,
                includePrepMeetings: includePrepMeetings,
                selectedMeetingIds: selectedMeetings,
                notes: notes
            });
        return;
    }
    
    setTimeout(() => {
        try {
            const { jsPDF } = window.jspdf;
            if (!jsPDF) throw new Error('jsPDF is not available');
            
            const pdf = new jsPDF('p', 'mm', 'a4');
            
            const meetings = dashboardData.meetings
                .filter(m => selectedMeetings.includes(m.id))
                .sort((a, b) => {
                    const dateCompare = new Date(a.date) - new Date(b.date);
                    if (dateCompare !== 0) return dateCompare;
                    return timeToMinutes(a.time24 || a.time) - timeToMinutes(b.time24 || b.time);
                });
            
            pdf.setFontSize(18);
            pdf.setFont(undefined, 'bold');
            pdf.text(title, 105, 20, { align: 'center' });
            
            let yPos = 35;
            pdf.setFontSize(11);
            pdf.setFont(undefined, 'normal');
            
            const meetingsByDate = {};
            meetings.forEach(m => {
                if (!meetingsByDate[m.date]) meetingsByDate[m.date] = [];
                meetingsByDate[m.date].push(m);
            });
            
            for (const date in meetingsByDate) {
                const dateMeetings = meetingsByDate[date];
                
                pdf.setFont(undefined, 'bold');
                pdf.setFontSize(13);
                pdf.text(dateMeetings[0].dateFormatted || date, 20, yPos);
                yPos += 8;
                
                pdf.setFont(undefined, 'normal');
                pdf.setFontSize(10);
                dateMeetings.forEach(m => {
                    if (yPos > 270) {
                        pdf.addPage();
                        yPos = 20;
                    }
                    
                    const timeLabel = formatTimeStandard(m.time) || 'TBD';
                    const prepLabel = includePrepMeetings && m.prepRequired ? '  Prep Required' : '';
                    pdf.text(`${timeLabel} - ${m.title}${prepLabel}`, 25, yPos);
                    yPos += 5;
                    
                    if (m.description) {
                        pdf.setFontSize(9);
                        const lines = pdf.splitTextToSize(m.description, 160);
                        pdf.text(lines, 30, yPos);
                        yPos += lines.length * 4 + 2;
                        pdf.setFontSize(10);
                    }
                    
                    yPos += 3;
                });
                
                yPos += 5;
            }
            
            if (notes) {
                if (yPos > 250) {
                    pdf.addPage();
                    yPos = 20;
                }
                pdf.setFont(undefined, 'bold');
                pdf.setFontSize(12);
                pdf.text('Notes & Commentary', 20, yPos);
                yPos += 6;
                pdf.setFont(undefined, 'normal');
                pdf.setFontSize(10);
                const lines = pdf.splitTextToSize(notes, 170);
                pdf.text(lines, 20, yPos);
            }
            
            if (previewMode) {
                const blobUrl = pdf.output('bloburl');
                window.open(blobUrl, '_blank');
            } else {
                pdf.save(`${title.replace(/[^a-z0-9]/gi, '_')}.pdf`);
            }
            exportBtn.disabled = false;
            exportBtn.innerHTML = originalText;
            closePDFExportModal();
        } catch (error) {
            console.error('PDF generation error:', error);
            alert('Error generating PDF: ' + error.message);
            exportBtn.disabled = false;
            exportBtn.innerHTML = originalText;
        }
    }, 100);
}

function previewPDFExport(btn) {
    generatePDFExport(btn, true);
}



</script>
</body>
</html>
